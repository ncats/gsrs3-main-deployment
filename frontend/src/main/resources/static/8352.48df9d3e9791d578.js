"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[8352],{48352:function($,T,u){u.r(T),u.d(T,{SubstanceHierarchyModule:function(){return B}});var b=u(48047),Z=u(78069),y=u(36362),M=u(24582),H=u(7318),N=u(2756),P=u(12570),k=u(44250),E=u(38205),d=u(34972),e=u(76442),S=u(65590);function U(r,l){1&r&&e._UZ(0,"mat-icon",19)}function q(r,l){if(1&r&&(e.TgZ(0,"span",20),e._uU(1),e.qZA()),2&r){var a=e.oxw().$implicit;e.xp6(1),e.hij(" ",a.relationship,"")}}var I=function(l,a){return{odd:l,primary:a}},O=function(l){return["/substances",l]},A=function(l){return["/substances",l,"edit"]};function D(r,l){if(1&r){var a=e.EpF();e.TgZ(0,"mat-tree-node",6),e.TgZ(1,"li",7),e.NdJ("click",function(){var s=e.CHM(a).$implicit;return e.oxw(3).activeNode=s}),e._UZ(2,"button",8),e.TgZ(3,"div",9),e.TgZ(4,"div",10),e.TgZ(5,"a",11),e._uU(6),e.qZA(),e.TgZ(7,"a",12),e.TgZ(8,"span",13),e._uU(9,"edit in new tab"),e.qZA(),e.YNc(10,U,1,0,"mat-icon",14),e.qZA(),e.qZA(),e._UZ(11,"div",15),e.TgZ(12,"div",16),e.TgZ(13,"span",17),e._uU(14),e.qZA(),e.YNc(15,q,2,1,"span",18),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){var i=l.$implicit,h=e.oxw(3);e.xp6(1),e.Q6J("ngClass",e.WLB(9,I,"odd"===i.order,h.activeNode===i)),e.xp6(1),e.uIk("aria-label",i.text),e.xp6(3),e.Q6J("ngClass",i.self?"current-record":"")("routerLink",e.VKq(12,O,i.value.refuuid||"")),e.xp6(1),e.hij(" ",i.value.refPname," "),e.xp6(1),e.Q6J("routerLink",e.VKq(14,A,i.value.refuuid||"")),e.xp6(3),e.Q6J("ngIf",h.isAdmin),e.xp6(4),e.Oqu(i.value.approvalID?i.value.approvalID:"PENDING"),e.xp6(1),e.Q6J("ngIf",""!==i.relationship)}}function L(r,l){1&r&&e._UZ(0,"mat-icon",29)}function J(r,l){if(1&r&&(e.TgZ(0,"span",20),e._uU(1),e.qZA()),2&r){var a=e.oxw().$implicit;e.xp6(1),e.hij(" ",a.relationship,"")}}function Q(r,l){if(1&r){var a=e.EpF();e.TgZ(0,"mat-nested-tree-node"),e.TgZ(1,"li",21),e.TgZ(2,"div",7),e.NdJ("click",function(){var s=e.CHM(a).$implicit;return e.oxw(3).activeNode=s})("click",function(){var s=e.CHM(a).$implicit;return e.oxw(3).activeNode=s}),e.TgZ(3,"button",22),e._UZ(4,"mat-icon",23),e.qZA(),e.TgZ(5,"div",24),e.TgZ(6,"div",10),e.TgZ(7,"a",25),e._uU(8),e.qZA(),e.TgZ(9,"a",26),e.YNc(10,L,1,0,"mat-icon",27),e.qZA(),e.qZA(),e.TgZ(11,"div",16),e.TgZ(12,"span",17),e._uU(13),e.qZA(),e.YNc(14,J,2,1,"span",18),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"ul"),e.GkF(16,28),e.qZA(),e.qZA(),e.qZA()}if(2&r){var i=l.$implicit,h=e.oxw(3);e.xp6(2),e.Q6J("ngClass",e.WLB(12,I,"odd"===i.order,h.activeNode===i)),e.xp6(1),e.uIk("aria-label","toggle "+i.text),e.xp6(1),e.Q6J("svgIcon",h.treeControl.isExpanded(i)?"chevron_down":"chevron_right"),e.xp6(3),e.Q6J("ngClass",i.self?"current-record":"")("routerLink",e.VKq(15,O,i.value.refuuid||"")),e.xp6(1),e.hij(" ",i.value.refPname," "),e.xp6(1),e.Q6J("routerLink",e.VKq(17,A,i.value.refuuid||"")),e.xp6(1),e.Q6J("ngIf",h.isAdmin),e.xp6(3),e.Oqu(i.value.approvalID||"PENDING"),e.xp6(1),e.Q6J("ngIf",""!==i.relationship),e.xp6(1),e.ekj("hierarchy-tree-invisible",!h.treeControl.isExpanded(i))}}function Y(r,l){if(1&r&&(e.TgZ(0,"mat-tree",3),e.YNc(1,D,16,16,"mat-tree-node",4),e.YNc(2,Q,17,19,"mat-nested-tree-node",5),e.qZA()),2&r){var a=e.oxw(2);e.Q6J("dataSource",a.dataSource)("treeControl",a.treeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",a.hasChild)}}function V(r,l){if(1&r&&(e.TgZ(0,"div"),e.TgZ(1,"div"),e.TgZ(2,"div",1),e._uU(3,"Substance Hierarchy"),e.qZA(),e.YNc(4,Y,3,3,"mat-tree",2),e.qZA(),e.qZA()),2&r){var a=e.oxw();e.xp6(4),e.Q6J("ngIf",a.dataSource.data&&a.dataSource.data.length>0)}}var F=function(){var r=function(l){(0,M.Z)(i,l);var a=(0,H.Z)(i);function i(h,t){var o;return(0,Z.Z)(this,i),(o=a.call(this)).substanceService=h,o.authService=t,o.treeControl=new E.VY(function(s){return s.children}),o.dataSource=new d.WX,o.hasChild=function(s,c){return!!c.children&&c.children.length>0},o}return(0,b.Z)(i,[{key:"ngOnInit",value:function(){var t=this;this.uuid=this.substance.uuid,this.name=this.substance._nameHTML,this.selfNode={id:0,type:"ROOT",parent:"#",expandable:!1,value:{refuuid:this.uuid,name:this.name,approvalID:this.approvalID||""},relationship:""},this.substanceService.getHierarchy(this.uuid).subscribe(function(o){t.loadHierarchy(o)},function(o){t.loadHierarchy([t.selfNode])}),this.isAdmin=this.authService.hasAnyRoles("Admin","Updater","SuperUpdater")}},{key:"loadHierarchy",value:function(t){0===t.length&&t.push(this.selfNode);for(var o=0;o<t.length;o++){var s=t[o];0===s.depth&&(s.parent="#")}t.length>1&&(t=this.formatHierarchy(t));var c=this.list_to_tree(t);this.dataSource.data=c,this.activeNode=this.dataSource.data[0]}},{key:"formatHierarchy",value:function(t){for(var o="",s="",c=[],n=t.length-1;n>=0;n--){0===t[n].depth&&(t[n].parent="#");var f=t[n].value;if(t[n].relationship="",f.refuuid===this.uuid&&(t[n].self=!0),!f.approvalID&&f.linkingID&&10===f.linkingID.length&&(t[n].value.approvalID=t[n].value.linkingID),!t[n].value.approvalID){var w=t[n].text.match(/\[(.*?)\]/);w&&(t[n].value.approvalID=w[1])}f.refuuid===o&&s.includes("HAS ACTIVE MOIETY")&&(c.push([t[n+1].id,t[n].id]),t.splice(n+1,1),t[n].relationship+="{ACTIVE MOIETY} "),t[n].type.includes("HAS ACTIVE MOIETY")?t[n].relationship+="{ACTIVE FORM} ":t[n].type.includes("IS SALT/SOLVATE OF")?t[n].relationship+="{SALT/SOLVATE} ":t[n].type.includes("IS SUBCONCEPT OF")?t[n].relationship+="{SUBCONCEPT} ":t[n].type.includes("IS G1SS CONSTITUENT OF")?t[n].relationship+="{G1SS} ":t[n].type.length>8&&(t[n].relationship="")&&(t[n].relationship+=" {"+t[n].type+"} "),t[n].refuuid=t[n].value.refuuid,o=t[n].refuuid,s=t[n].type}t.sort(function(m,v){var _=m.refuuid.toUpperCase(),C=v.refuuid.toUpperCase();return _===C?m.parent<v.parent?-1:m.parent>v.parent?1:0:_<C?-1:_>C?1:0});for(var p=t.length-1;p>=0;p--)p!==t.length-1&&t[p].value.refuuid===t[p+1].value.refuuid&&t[p].parent===t[p+1].parent&&(t[p].type.includes("HAS ACTIVE MOIETY")&&t[p+1].type.includes("IS SALT/SOLVATE OF")?(c.push([t[p].id,t[p+1].id]),t.splice(p,1)):t[p+1].type.includes("HAS ACTIVE MOIETY")&&t[p].type.includes("IS SALT/SOLVATE OF")&&(c.push([t[p+1].id,t[p].id]),t.splice(p+1,1)));t.sort(function(m,v){return m.id-v.id});for(var g=t.length-1;g>=0;g--)for(var x=0;x<c.length;x++)t[g].parent===c[x][0]&&(t[g].parent=c[x][1]);return t}},{key:"list_to_tree",value:function(t){var c,n,o={},s=[];for(n=0;n<t.length;n+=1)o[t[n].id]=n,t[n].children=[],t[n].order=0===n?"primary":n%2==0?"even":"odd";for(n=0;n<t.length;n+=1)"#"!==(c=t[n]).parent?t[o[c.parent]].children.push(c):s.push(c);return s}}]),i}(N.B);return r.\u0275fac=function(a){return new(a||r)(e.Y36(P.d),e.Y36(k.e))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-substance-hierarchy"]],features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"label","tree-label"],["class","hierarchy-tree",3,"dataSource","treeControl",4,"ngIf"],[1,"hierarchy-tree",3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle",""],[1,"mat-tree-node",3,"ngClass","click"],["mat-icon-button","","disabled","",1,"tree-button"],[1,"node-container","nochild"],[1,"title"],["tabindex","0","role","link","matTooltip","view substance details","aria-label","view substance",1,"hierarchy-link",3,"ngClass","routerLink"],["tabindex","0","role","link","target","_blank","matTooltip","edit substance in new tab","aria-label","edit substance in new tab",1,"hierarchy-edit",3,"routerLink"],["hidden",""],["svgIcon","edit","color","primary",4,"ngIf"],[1,"filler"],[1,"right-container"],[1,"approval"],["class","end",4,"ngIf"],["svgIcon","edit","color","primary"],[1,"end"],[1,"no-border"],["mat-icon-button","","matTreeNodeToggle","",1,"tree-button"],[3,"svgIcon"],[1,"node-container"],["tabindex","0","role","link","matTooltip","view substance details",1,"hierarchy-link",3,"ngClass","routerLink"],["tabindex","0","role","link","aria-label","edit substance in new tab",1,"hierarchy-edit",3,"routerLink"],["matTooltip","edit substance in new tab","svgIcon","edit","color","primary",4,"ngIf"],["matTreeNodeOutlet",""],["matTooltip","edit substance in new tab","svgIcon","edit","color","primary"]],template:function(a,i){1&a&&e.YNc(0,V,5,1,"div",0),2&a&&e.Q6J("ngIf",i.substance)},directives:[y.O5,d.gi,d.fQ,d.uo,d.eu,y.mk,S.Hw,d.GZ,d.Ar],styles:[".mat-tree-node[_ngcontent-%COMP%]{min-height:30px!important}.hierarchy-tree-invisible[_ngcontent-%COMP%]{display:none}.hierarchy-tree[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .hierarchy-tree[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0;list-style-type:none}.spacer[_ngcontent-%COMP%]{width:50%}.approval[_ngcontent-%COMP%]{color:maroon;-ms-flex:0 0 100%;flex:0 0 100%}.end[_ngcontent-%COMP%]{white-space:nowrap;max-width:250px;-ms-flex:0 0 100%;flex:0 0 100%;-ms-flex-wrap:nowrap;flex-wrap:nowrap;overflow:hidden;font-style:italic;text-overflow:ellipsis}.hierarchy-link[_ngcontent-%COMP%]{white-space:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;overflow:hidden;text-overflow:ellipsis}.tree-button[_ngcontent-%COMP%]{height:30px!important;line-height:30px!important;width:35px;background-color:transparent;border:0px}.right-container[_ngcontent-%COMP%]{max-width:250px;text-align:right;white-space:nowrap;-ms-flex-wrap:wrap;flex-wrap:wrap;display:-ms-flexbox;display:flex;padding-right:10px;margin:4px;vertical-align:top;-ms-flex-pack:right;justify-content:right}.title[_ngcontent-%COMP%]{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;max-width:calc(100% - 300px)}.tree-label[_ngcontent-%COMP%]{padding-bottom:10px;font-weight:700}.filler[_ngcontent-%COMP%]{-ms-flex:1 1 auto;flex:1 1 auto;vertical-align:center;height:2px;margin-top:auto;margin-bottom:auto;margin-left:50px;padding-left:20px}.filler-line[_ngcontent-%COMP%]{height:2px;width:100%}.no-border[_ngcontent-%COMP%]{border-top:0px}.primary[_ngcontent-%COMP%]{background-color:#cee8fb!important}.hierarchy-link[_ngcontent-%COMP%]{color:#448aff;font-style:unset;max-lines:2}.odd[_ngcontent-%COMP%]{background-color:#0000000d}.node-container[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;width:calc(100% - 35px);-ms-flex-pack:justify;justify-content:space-between}.hierarchy-edit[_ngcontent-%COMP%]{height:20px;margin-left:15px}.mat-card[_ngcontent-%COMP%]{max-width:1228px;margin-bottom:20px}.mat-card[_ngcontent-%COMP%], .controls-container[_ngcontent-%COMP%]{width:100%;box-sizing:border-box}.current-record[_ngcontent-%COMP%]{font-weight:700}"]}),r}(),j=u(64061),B=function(){var r=(0,b.Z)(function l(){(0,Z.Z)(this,l)});return r.\u0275fac=function(a){return new(a||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[y.ez,j.o.forChild(F),d.dp,S.Ps]]}),r}()}}]);
//# sourceMappingURL=8352.48df9d3e9791d578.js.map