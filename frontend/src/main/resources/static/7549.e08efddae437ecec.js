"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[7549],{7549:function(Tt,x,c){c.r(x),c.d(x,{SubstanceRelationshipsModule:function(){return bt}});var Z=c(1884),b=c(39117),h=c(36362),O=c(46751),J=c(56101),q=c(52149),y=c(92507),N=c(54025),Y=c(24874),L=c(50253),t=c(86613),f=c(95758),I=c(54244),A=c(44770),_=c(43365),g=c(90587),Q=c(88951),E=c(59295),P=c(12570),H=c(35096),v=c(98002),B=c(93392),R=c(40089),C=c(65590);function V(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"button",1),t.NdJ("click",function(){return t.CHM(a),t.oxw().export("relationships")}),t._UZ(2,"mat-icon",2),t.qZA(),t.qZA()}}var j=function(){var n=function(){function s(a,i,l,e,o,u,d){(0,b.Z)(this,s),this.configService=a,this.authService=i,this.substanceService=l,this.router=e,this.activatedRoute=o,this.loadingService=u,this.dialog=d,this.subscriptions=[],this.isAdmin=!1,this.privateExport=!1,this.etag="",this.paramUrl="",this.totalSubstance=0,this.hasAdditionalDownloads=!1,this.additionalExportOptions=[]}return(0,Z.Z)(s,[{key:"ngOnInit",value:function(){var i=this;this.authService.hasAnyRolesAsync("Admin","Updater","SuperUpdater").pipe((0,E.q)(1)).subscribe(function(l){i.isAdmin=l}),this.loadedComponents=this.configService.configData&&this.configService.configData.loadedComponents||null}},{key:"ngAfterViewInit",value:function(){}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(i){i&&i.unsubscribe()})}},{key:"export",value:function(i){var l=this,e=this.substanceService.searchFromString('q=root_uuid:"^'+this.substance.uuid+'$"').subscribe(function(o){if(o&&(l.etag=o.etag,l.totalSubstance=o.total),l.etag){var u="relationships.txt",d=l.getApiExportUrl(l.etag,u,i);if(!0===l.isAdmin){var r="";null!=i&&"relationships"===i&&(r="export"),l.dialog.open(H.L,{width:"700px",data:{extension:u,type:r,entity:"substances",hideOptionButtons:!0}}).afterClosed().subscribe(function(D){var T=D.name,Ct=D.id;T&&""!==T&&(l.loadingService.setLoading(!0),l.authService.startUserDownload(d,l.privateExport,T+"."+u,Ct).subscribe(function(M){l.loadingService.setLoading(!1),l.router.navigate(["/user-downloads/",M.id])},function(M){return l.loadingService.setLoading(!1)}))})}}});this.subscriptions.push(e)}},{key:"getApiExportUrl",value:function(i,l,e){return"".concat(this.configService.configData.apiBaseUrl,"api/v1/substances/export/").concat(i,"/").concat(l)}}]),s}();return n.\u0275fac=function(a){return new(a||n)(t.Y36(y.E),t.Y36(Q.e),t.Y36(P.d),t.Y36(v.F0),t.Y36(v.gz),t.Y36(B.b),t.Y36(f.uw))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-relationships-download-button"]],inputs:{substance:"substance"},decls:2,vars:1,consts:[[4,"ngIf"],["mat-icon-button","","matTooltip","Export all relationships from this substancce",2,"padding-top","3px","background-color","white","border","none",3,"click"],["svgIcon","get_app"]],template:function(a,i){1&a&&(t.TgZ(0,"div"),t.YNc(1,V,3,0,"div",0),t.qZA()),2&a&&(t.xp6(1),t.Q6J("ngIf",i.isAdmin))},directives:[h.O5,R.gM,C.Hw],styles:[""]}),n}(),p=c(97217),S=c(64316),k=c(9292),$=c(73430),U=c(26439);function F(n,s){1&n&&(t.TgZ(0,"th",18),t._uU(1," Related Record"),t.qZA())}var w=function(s){return["/substances",s]};function z(n,s){if(1&n&&(t.TgZ(0,"td",19),t.TgZ(1,"div",20),t.TgZ(2,"div"),t._uU(3),t.qZA(),t._UZ(4,"img",21),t.TgZ(5,"div"),t.TgZ(6,"a",22),t._UZ(7,"span",23),t._UZ(8,"mat-icon",24),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&n){var a=s.$implicit;t.xp6(3),t.Oqu(a.relatedSubstance.linkingID),t.xp6(1),t.Q6J("entityId",a.relatedSubstance.refuuid),t.xp6(2),t.Q6J("routerLink",t.VKq(4,w,a.relatedSubstance.refuuid)),t.xp6(1),t.Q6J("innerHTML",a.relatedSubstance.name,t.oJD)}}function X(n,s){1&n&&(t.TgZ(0,"th",18),t._uU(1," Type "),t.qZA())}function K(n,s){if(1&n&&(t.TgZ(0,"td",25),t._uU(1),t.qZA()),2&n){var a=s.$implicit;t.xp6(1),t.hij(" ",a.type," ")}}function W(n,s){1&n&&(t.TgZ(0,"th",26),t._uU(1," Details "),t.qZA())}function G(n,s){if(1&n&&(t.TgZ(0,"div",20),t.TgZ(1,"div"),t._uU(2),t.qZA(),t._UZ(3,"img",21),t.TgZ(4,"div"),t.TgZ(5,"a",22),t._UZ(6,"span",23),t._UZ(7,"mat-icon",24),t.qZA(),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(2),t.Oqu(a.mediatorSubstance.linkingID),t.xp6(1),t.Q6J("entityId",a.mediatorSubstance.refuuid),t.xp6(2),t.Q6J("routerLink",t.VKq(4,w,a.mediatorSubstance.refuuid)),t.xp6(1),t.Q6J("innerHTML",a.mediatorSubstance.name,t.oJD)}}function tt(n,s){1&n&&(t.TgZ(0,"div"),t.TgZ(1,"i"),t._uU(2,"none"),t.qZA(),t.qZA())}function et(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Interaction Type: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(4),t.hij(" ",a.interactionType," ")}}function nt(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Comments: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(4),t.hij(" ",a.comments," ")}}function it(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Qualification: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(4),t.hij(" ",a.qualification," ")}}function at(n,s){if(1&n&&(t.TgZ(0,"i"),t._uU(1),t.qZA()),2&n){var a=t.oxw(3).$implicit;t.xp6(1),t.Oqu(a.amount.nonNumericValue)}}function ot(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Amount: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.YNc(5,at,2,1,"i",35),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit,i=t.oxw();t.xp6(4),t.hij(" ",i.displayAmount(a.amount)," "),t.xp6(1),t.Q6J("ngIf",a.amount.nonNumericValue)}}function st(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"h2",29),t._uU(1,"Details"),t.qZA(),t.TgZ(2,"div",30),t.TgZ(3,"table",31),t.TgZ(4,"tr"),t.TgZ(5,"th",32),t._uU(6," Mediator Substance "),t.qZA(),t.TgZ(7,"th",32),t._uU(8," Details "),t.qZA(),t.qZA(),t.TgZ(9,"tr"),t.TgZ(10,"td",33),t.YNc(11,G,8,6,"div",34),t.YNc(12,tt,3,0,"div",35),t.qZA(),t.TgZ(13,"td",33),t.YNc(14,et,5,1,"div",36),t.YNc(15,nt,5,1,"div",36),t.YNc(16,it,5,1,"div",36),t.YNc(17,ot,6,2,"div",36),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"div",37),t._UZ(19,"span",1),t.TgZ(20,"button",38),t.NdJ("click",function(){return t.CHM(a),t.oxw(2).close()}),t._uU(21,"Close"),t.qZA(),t.qZA()}if(2&n){var i=t.oxw().$implicit;t.xp6(11),t.Q6J("ngIf",i.mediatorSubstance),t.xp6(1),t.Q6J("ngIf",!i.mediatorSubstance),t.xp6(2),t.Q6J("ngIf",i.interactionType),t.xp6(1),t.Q6J("ngIf",i.comments),t.xp6(1),t.Q6J("ngIf",i.qualification),t.xp6(1),t.Q6J("ngIf",i.amount)}}function lt(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"td",25),t.TgZ(1,"button",27),t.NdJ("click",function(){t.CHM(a);var e=t.MAs(4);return t.oxw().openModal(e)}),t._uU(2," View"),t.qZA(),t.YNc(3,st,22,6,"ng-template",null,28,t.W1O),t.qZA()}if(2&n){var i=s.$implicit;t.xp6(1),t.Q6J("disabled",!(i.mediatorSubstance&&i.mediatorSubstance.name||i.qualification||i.interactionType||i.comments||i.amount&&i.amount.nonNumericValue))("ngClass",i.mediatorSubstance&&i.mediatorSubstance.name||i.qualification||i.interactionType||i.comments||i.amount&&i.amount.nonNumericValue?"":"mat-button-disabled")}}function ct(n,s){1&n&&(t.TgZ(0,"th",26),t._uU(1," References "),t.qZA())}function rt(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"h2",29),t._uU(1,"References"),t.qZA(),t.TgZ(2,"div",30),t._UZ(3,"app-references-manager",44),t.qZA(),t.TgZ(4,"div",37),t._UZ(5,"span",1),t.TgZ(6,"button",38),t.NdJ("click",function(){return t.CHM(a),t.oxw(2).close()}),t._uU(7,"Close"),t.qZA(),t.qZA()}if(2&n){var i=t.oxw().$implicit,l=t.oxw();t.xp6(3),t.Q6J("substance",l.substance)("references",i.references)}}function ut(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"td",25),t.TgZ(1,"button",42),t.NdJ("click",function(){t.CHM(a);var e=t.MAs(4);return t.oxw().openModal(e)}),t._uU(2),t.qZA(),t.YNc(3,rt,8,2,"ng-template",null,43,t.W1O),t.qZA()}if(2&n){var i=s.$implicit;t.xp6(1),t.Q6J("disabled",i.references.length<=0),t.xp6(1),t.hij("View ",i.references.length>0?i.references.length:""," references")}}function dt(n,s){1&n&&t._UZ(0,"tr",45)}function pt(n,s){1&n&&t._UZ(0,"tr",46)}var ft=function(){return[5,10,25,100]},mt=function(){var n=function(s){(0,O.Z)(i,s);var a=(0,J.Z)(i);function i(l,e,o,u,d){var r;return(0,b.Z)(this,i),(r=a.call(this,u)).utilService=l,r.configService=e,r.dialog=o,r.gaService=u,r.overlayContainerService=d,r.relationships=[],r.displayedColumns=["relatedRecord","type","details","references"],r.substanceUpdated=new L.x,r}return(0,Z.Z)(i,[{key:"ngOnInit",value:function(){var e=this;this.substanceUpdated.subscribe(function(o){if(e.relationships=[],e.substance=o,"RELATIONSHIPS"===e.type&&e.configService.configData&&e.configService.configData.substanceDetailsCards&&e.configService.configData.substanceDetailsCards.length){var u=e.configService.configData.substanceDetailsCards.find(function(r){return r.type===e.type});if(null!=u&&u.filters&&u.filters.length){var d=u.filters.find(function(r){return"substanceRelationships"===r.filterName})||{value:[]};e.excludedRelationships=d.value}}null!=e.substance&&null!=e.type&&(e.filterRelationhships(),e.countUpdate.emit(e.relationships.length),e.filtered=e.relationships,e.pageChange(),e.searchControl.valueChanges.subscribe(function(r){e.filterList(r,e.relationships,e.analyticsEventCategory)},function(r){console.log(r)}))}),this.overlayContainer=this.overlayContainerService.getContainerElement()}},{key:"sortData",value:function(e){var o=this,u=this.relationships.slice();if(!e.active||""===e.direction)return this.filtered=u,void this.pageChange();this.filtered=u.sort(function(d,r){var m="asc"===e.direction;switch(e.active){case"relatedRecord":return o.utilService.compare(d.relatedSubstance.name?d.relatedSubstance.name.toUpperCase():"",r.relatedSubstance.name?r.relatedSubstance.name.toUpperCase():"",m);case"type":return o.utilService.compare(d.type?d.type:"",r.type?r.type:"",m);default:return 0}}),this.pageChange(),this.overlayContainer=this.overlayContainerService.getContainerElement()}},{key:"filterRelationhships",value:function(){var e=this;this.substance.relationships&&this.substance.relationships.length>0&&this.substance.relationships.forEach(function(o){var u=o.type,d=u&&u.trim()||"";if(null!=e.excludedRelationships&&e.excludedRelationships instanceof Array){var r=!1;e.excludedRelationships.forEach(function(m){d.toLowerCase().indexOf(m.toLowerCase())>-1&&(r=!0)}),r||e.relationships.push(o)}else d.toLowerCase().indexOf(e.type.toLowerCase())>-1&&e.relationships.push(o)})}},{key:"hasDetails",value:function(e){return!!(e.mediatorSubstance&&e.mediatorSubstance.name||e.amount||e.qualification||e.interactionType||e.comments)}},{key:"openModal",value:function(e){var o=this;this.gaService.sendEvent(this.analyticsEventCategory,"button","references view");var u=this.dialog.open(e,{});this.overlayContainer.style.zIndex="1002",u.afterClosed().subscribe(function(d){o.overlayContainer.style.zIndex=null})}},{key:"formatValue",value:function(e){return e?"object"==typeof e?e.display?e.display:e.value?e.value:null:e:null}},{key:"displayAmount",value:function(e){var o="";if(e&&"object"==typeof e&&e){var u=!1,d=this.formatValue(e.units);d||(d="");var r=this.formatValue(e.type);r&&(o+=r+"\n"),(e.average||e.high||e.low)&&(e.average&&(o+=e.average,e.units&&(o+=" "+d,u=!0)),(e.high||e.low)&&(o+=" [",e.high&&!e.low?o+="<"+e.high:!e.high&&e.low?o+=">"+e.low:e.high&&e.low&&(o+=e.low+" to "+e.high),o+="] ",u||e.units&&(o+=" "+d,u=!0)),o+=" (average) "),(e.highLimit||e.lowLimit)&&(o+="\n["),e.highLimit&&!e.lowLimit?o+="<"+e.highLimit:!e.highLimit&&e.lowLimit?o+=">"+e.lowLimit:e.highLimit&&e.lowLimit&&(o+=e.lowLimit+" to "+e.highLimit),(e.highLimit||e.lowLimit)&&(o+="] ",u||e.units&&(o+=" "+d,u=!0),o+=" (limits)")}return o}},{key:"close",value:function(){this.dialog.closeAll()}}]),i}(N.u);return n.\u0275fac=function(a){return new(a||n)(t.Y36(q.F),t.Y36(y.E),t.Y36(f.uw),t.Y36(Y.$),t.Y36(I.Xj))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-substance-relationships"]],features:[t.qOj],decls:22,vars:10,consts:[[1,"flex-row"],[1,"middle-fill"],[1,"search",3,"floatLabel"],["matInput","","placeholder","Search",3,"formControl"],[2,"padding-left","30px",3,"substance"],[1,"responsive"],["mat-table","","matSort","",3,"dataSource","matSortChange"],["matColumnDef","relatedRecord"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","text-center","mat-cell","",4,"matCellDef"],["matColumnDef","type"],["mat-cell","",4,"matCellDef"],["matColumnDef","details"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","references"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"text-center"],[1,"thumb-col"],["appSubstanceImage","",1,"structure-image",3,"entityId"],["target","_blank",1,"substance-name",2,"height","18px",3,"routerLink"],[3,"innerHTML"],["svgIcon","open_in_new",1,"icon"],["mat-cell",""],["mat-header-cell",""],[1,"mat-raised-button","mat-primary",3,"disabled","ngClass","click"],["detailTemplate",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"details-table","mat-table"],[1,"mat-header-cell"],[1,"mat-cell"],["class","thumb-col",4,"ngIf"],[4,"ngIf"],["class","detail",4,"ngIf"],["mat-dialog-actions",""],["mat-dialog-close","",1,"mat-raised-button","mat-primary",3,"click"],[1,"detail"],[1,"subhead"],[1,"subval"],[1,"mat-raised-button","mat-primary",3,"disabled","click"],["refTemplate",""],[3,"substance","references"],["mat-header-row",""],["mat-row",""]],template:function(a,i){1&a&&(t.TgZ(0,"div",0),t._UZ(1,"span",1),t.TgZ(2,"mat-form-field",2),t._UZ(3,"input",3),t.qZA(),t._UZ(4,"app-relationships-download-button",4),t.qZA(),t.TgZ(5,"div",5),t.TgZ(6,"table",6),t.NdJ("matSortChange",function(e){return i.sortData(e)}),t.ynx(7,7),t.YNc(8,F,2,0,"th",8),t.YNc(9,z,9,6,"td",9),t.BQk(),t.ynx(10,10),t.YNc(11,X,2,0,"th",8),t.YNc(12,K,2,1,"td",11),t.BQk(),t.ynx(13,12),t.YNc(14,W,2,0,"th",13),t.YNc(15,lt,5,2,"td",11),t.BQk(),t.ynx(16,14),t.YNc(17,ct,2,0,"th",13),t.YNc(18,ut,5,2,"td",11),t.BQk(),t.YNc(19,dt,1,0,"tr",15),t.YNc(20,pt,1,0,"tr",16),t.qZA(),t.qZA(),t.TgZ(21,"mat-paginator",17),t.NdJ("page",function(e){return i.pageChange(e,i.analyticsEventCategory)}),t.qZA()),2&a&&(t.xp6(2),t.Q6J("floatLabel","never"),t.xp6(1),t.Q6J("formControl",i.searchControl),t.xp6(1),t.Q6J("substance",i.substance),t.xp6(2),t.Q6J("dataSource",i.paged),t.xp6(13),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(1),t.Q6J("length",i.filtered&&i.filtered.length||0)("pageSize",5)("pageSizeOptions",t.DdM(9,ft)))},directives:[A.KE,_.Nt,g.Fj,g.JJ,g.oH,j,p.BZ,S.YE,p.w1,p.fO,p.ge,S.nU,p.Dz,p.ev,k.m,v.yS,C.Hw,h.mk,f.uh,f.xY,h.O5,f.H8,f.ZT,$.C,p.as,p.XQ,p.nj,p.Gk,U.NW],styles:["table.mat-table[_ngcontent-%COMP%]{width:100%}td.mat-cell[_ngcontent-%COMP%]:not(:last-child), td.mat-footer-cell[_ngcontent-%COMP%]:not(:last-child), th.mat-header-cell[_ngcontent-%COMP%]:not(:last-child){padding-right:10px}.no-bottom-border[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td.mat-cell[_ngcontent-%COMP%]{border-bottom:none}.mat-sort-header-content[_ngcontent-%COMP%]{display:block!important}td.mat-cell[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%], th.mat-header-cell[_ngcontent-%COMP%]{padding-top:10px;padding-bottom:10px}.structure-image[_ngcontent-%COMP%]{width:150px;height:auto}.search[_ngcontent-%COMP%]{width:400px;max-width:100%}.thumb-col[_ngcontent-%COMP%]{max-width:400px}.subhead[_ngcontent-%COMP%]{display:inline-block;width:130px}.subval[_ngcontent-%COMP%]{display:inline}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px}"]}),n}(),gt=c(64061),ht=c(38277),vt=c(33865),Zt=c(24054),bt=function(){var n=(0,Z.Z)(function s(){(0,b.Z)(this,s)});return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[h.ez,gt.o.forChild(mt),p.p0,ht.V,C.Ps,f.Is,U.TU,g.u5,A.lN,g.UX,_.c,vt.HT,R.AV,v.Bz,S.JX,Zt.f]]}),n}()}}]);
//# sourceMappingURL=7549.e08efddae437ecec.js.map