"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[3127],{93127:function(q,f,i){i.r(f),i.d(f,{SubstanceFormLinksModule:function(){return W}});var m=i(1884),v=i(39117),d=i(36362),L=i(75143),y=i(7168),h=i(19975),g=i(65590),p=i(87317),S=i(94673),Z=i(44770),k=i(90587),T=i(26439),x=i(43365),C=i(40089),F=i(31959),I=i(46751),A=i(56101),D=i(79550),b=i(33567),O=i(40104),U=i(21109),n=i(86613),M=i(78444),N=i(51279),E=i(18291),J=i(63169),P=i(39401),Y=i(59295),Q=i(95758),R=i(54244),j=i(16667),V=i(14900);function $(o,l){if(1&o){var e=n.EpF();n.TgZ(0,"div",16),n._uU(1," Deleted\xa0 "),n.TgZ(2,"button",17),n.NdJ("click",function(){return n.CHM(e),n.oxw().undoDelete()}),n._UZ(3,"mat-icon",18),n.qZA(),n.qZA()}}function G(o,l){if(1&o&&(n.TgZ(0,"div"),n._UZ(1,"img",19),n.qZA()),2&o){var e=n.oxw();n.xp6(1),n.Q6J("src",e.structure,n.LSH)}}var z=function(){var o=function(){function l(e,t,a,s,u){(0,v.Z)(this,l),this.cvService=e,this.dialog=t,this.utilsService=a,this.overlayContainerService=s,this.substanceFormService=u,this.linkDeleted=new n.vpe,this.subscriptions=[],this.structure=null}return(0,m.Z)(l,[{key:"ngOnInit",value:function(){this.getVocabularies(),this.overlayContainer=this.overlayContainerService.getContainerElement(),this.updateDisplay()}},{key:"getStructure",value:function(){var t=this;this.smiles=this.vocabulary[this.privateLink.linkage],this.smiles&&this.smiles.fragmentStructure?this.structure=this.cvService.getStructureUrlFragment(this.smiles.fragmentStructure):this.cvService.getDomainVocabulary("NUCLEIC_ACID_LINKAGE").pipe((0,Y.q)(1)).subscribe(function(a){var u=!1;a.NUCLEIC_ACID_LINKAGE.list.forEach(function(c){c.value===t.privateLink.linkage&&(t.smiles=c,u=!0,t.structure=t.cvService.getStructureUrlFragment(t.smiles.fragmentStructure))}),u||(t.structure=null)})}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(t){t.unsubscribe()})}},{key:"link",get:function(){return this.updateDisplay(),this.privateLink},set:function(t){this.privateLink=t,this.getStructure()}},{key:"updateLinkage",value:function(t){this.privateLink.linkage=t,this.getStructure()}},{key:"addRemainingSites",value:function(){this.privateLink.sites=this.privateLink.sites?this.privateLink.sites.concat(this.remaining):this.remaining,this.updateDisplay(),this.substanceFormService.emitLinkUpdate()}},{key:"updateDisplay",value:function(){this.privateLink&&(this.siteDisplay=this.substanceFormService.siteString(this.privateLink.sites))}},{key:"deleteLink",value:function(){var t=this;this.privateLink.$$deletedCode=this.utilsService.newUUID(),this.deleteTimer=setTimeout(function(){t.linkDeleted.emit(t.link),t.substanceFormService.emitLinkUpdate()},2e3)}},{key:"undoDelete",value:function(){clearTimeout(this.deleteTimer),delete this.privateLink.$$deletedCode}},{key:"getVocabularies",value:function(){var t=this,a=this.cvService.getDomainVocabulary("NUCLEIC_ACID_LINKAGE").subscribe(function(s){t.linkageTypes=s.NUCLEIC_ACID_LINKAGE.list,t.vocabulary=s.NUCLEIC_ACID_LINKAGE.dictionary,t.smiles=t.vocabulary[t.privateLink.linkage],t.getStructure()});this.subscriptions.push(a)}},{key:"openDialog",value:function(){var t=this,a=this.dialog.open(P.r,{data:{card:"link",link:this.privateLink.sites},width:"1040px"});this.overlayContainer.style.zIndex="1002";var s=a.afterClosed().subscribe(function(u){t.overlayContainer.style.zIndex=null,u&&(t.privateLink.sites=u),t.updateDisplay(),t.substanceFormService.emitLinkUpdate()});this.subscriptions.push(s)}}]),l}();return o.\u0275fac=function(e){return new(e||o)(n.Y36(E.I),n.Y36(Q.uw),n.Y36(J.FW),n.Y36(R.Xj),n.Y36(b.B))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-link-form"]],inputs:{remaining:"remaining",link:"link"},outputs:{linkDeleted:"linkDeleted"},decls:19,vars:8,consts:[[1,"link-form-container"],["class","notification-backdrop",4,"ngIf"],[1,"form-row"],[1,"delete-container"],["mat-icon-button","","matTooltip","Delete link",3,"click"],["svgIcon","delete_forever"],[4,"ngIf"],[1,"type"],["domain","NUCLEIC_ACID_LINKAGE","title","Sequence Type",3,"model","valueChange"],[1,"addRemaining"],["mat-flat-button","","mat-primary","",3,"matTooltip","disabled","click"],[1,"links"],[1,"label"],["mat-icon-button","","matTooltip","Select sites from display",3,"click"],["svgIcon","edit"],[3,"source"],[1,"notification-backdrop"],["mat-icon-button","","matTooltip","Undo",3,"click"],["svgIcon","undo"],[1,"structure-image",3,"src"]],template:function(e,t){1&e&&(n.TgZ(0,"div",0),n.YNc(1,$,4,0,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n.TgZ(4,"button",4),n.NdJ("click",function(){return t.deleteLink()}),n._UZ(5,"mat-icon",5),n.qZA(),n.qZA(),n.YNc(6,G,2,1,"div",6),n.TgZ(7,"div",7),n.TgZ(8,"app-cv-input",8),n.NdJ("valueChange",function(s){return t.updateLinkage(s)}),n.qZA(),n.qZA(),n.TgZ(9,"div",9),n.TgZ(10,"button",10),n.NdJ("click",function(){return t.addRemainingSites()}),n._uU(11),n.qZA(),n.qZA(),n.TgZ(12,"div",11),n.TgZ(13,"div",12),n._uU(14,"link"),n.qZA(),n._uU(15),n.TgZ(16,"button",13),n.NdJ("click",function(){return t.openDialog()}),n._UZ(17,"mat-icon",14),n.qZA(),n.qZA(),n.qZA(),n._UZ(18,"app-audit-info",15),n.qZA()),2&e&&(n.xp6(1),n.Q6J("ngIf",t.link.$$deletedCode),n.xp6(5),n.Q6J("ngIf",t.structure),n.xp6(2),n.Q6J("model",t.privateLink.linkage),n.xp6(2),n.MGl("matTooltip","Add remaining ",t.remaining.length," sites"),n.Q6J("disabled",0===t.remaining.length),n.xp6(1),n.hij(" add remaining ",t.remaining.length," sites "),n.xp6(4),n.hij(" ",t.siteDisplay," "),n.xp6(3),n.Q6J("source",t.privateLink))},directives:[d.O5,p.lW,C.gM,g.Hw,j.S,V.n],styles:[".link-form-container[_ngcontent-%COMP%]{padding:30px 10px 12px;position:relative}.notification-backdrop[_ngcontent-%COMP%]{position:absolute;inset:0;display:-ms-flexbox;display:flex;z-index:10;background-color:var(--notif-backdrop-bg-color);-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;font-size:30px;font-weight:700;color:var(--notif-backdrop-color)}.form-row[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:end;align-items:flex-end}.form-row[_ngcontent-%COMP%]   .delete-container[_ngcontent-%COMP%]{padding:0 10px 8px 0}.form-row[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{-ms-flex-positive:1;flex-grow:1;padding-right:15px}.form-row[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{width:30%;margin-right:5px}.form-row[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]{width:40%}.form-row[_ngcontent-%COMP%]   .addRemaining[_ngcontent-%COMP%]{width:20%}.selectedSite[_ngcontent-%COMP%]{padding-left:2px;padding-right:2px}.structure-image[_ngcontent-%COMP%]{margin-bottom:-20px;margin-left:-10px}"]}),o}();function K(o,l){1&o&&n._UZ(0,"mat-divider",10),2&o&&n.Q6J("inset",!0)}function H(o,l){if(1&o){var e=n.EpF();n.TgZ(0,"div",7),n.TgZ(1,"app-link-form",8),n.NdJ("linkDeleted",function(r){return n.CHM(e),n.oxw().deleteLink(r)}),n.qZA(),n.YNc(2,K,1,1,"mat-divider",9),n.qZA()}if(2&o){var t=l.$implicit,a=l.last,s=l.index,u=n.oxw();n.Q6J("id","substance-other-links-"+s),n.xp6(1),n.Q6J("link",t)("remaining",u.remainingSites),n.xp6(1),n.Q6J("ngIf",!a)}}var X=function(){var o=function(l){(0,I.Z)(t,l);var e=(0,A.Z)(t);function t(a,s,u,c){var r;return(0,v.Z)(this,t),(r=e.call(this,c)).substanceFormLinksService=a,r.substanceFormService=s,r.scrollToService=u,r.gaService=c,r.remainingSites=[],r.invalidSites=0,r.subscriptions=[],r.analyticsEventCategory="substance form links",r}return(0,m.Z)(t,[{key:"ngOnInit",value:function(){this.canAddItemUpdate.emit(!0),this.menuLabelUpdate.emit("Links")}},{key:"ngAfterViewInit",value:function(){var s=this,u=this.substanceFormLinksService.substanceLinks.subscribe(function(r){s.links=r,s.getRemainingSites()});this.subscriptions.push(u);var c=this.substanceFormService.substanceSubunits.subscribe(function(r){s.subunits=r,s.getRemainingSites()});this.subscriptions.push(c)}},{key:"ngOnDestroy",value:function(){this.componentDestroyed.emit(),this.subscriptions.forEach(function(s){s.unsubscribe()})}},{key:"getRemainingSites",value:function(){var s=[],u=[];this.subunits&&this.links&&(this.subunits.forEach(function(c){if(null!=c.sequence&&c.sequence.length>0)for(var r=2;r<=c.sequence.length;r++)u.push({subunitIndex:c.subunitIndex,residueIndex:r})}),this.links.forEach(function(c){s=s.concat(c.sites)})),this.remainingSites=u.filter(function(c){return!s.some(function(r){return c.subunitIndex===r.subunitIndex&&c.residueIndex===r.residueIndex})}),this.invalidSites=u.length-s.length}},{key:"addItem",value:function(){this.addOtherLink()}},{key:"addOtherLink",value:function(){var s=this;this.substanceFormLinksService.addSubstanceLink(),setTimeout(function(){s.scrollToService.scrollToElement("substance-other-links-0","center")})}},{key:"deleteLink",value:function(s){this.substanceFormLinksService.deleteSubstanceLink(s)}}]),t}(D.u);return o.\u0275fac=function(e){return new(e||o)(n.Y36(U.e),n.Y36(b.B),n.Y36(M.i),n.Y36(O.$))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-substance-form-links"]],features:[n.qOj],decls:10,vars:3,consts:[[1,"responsive"],[1,"form-row"],[1,"form-row",3,"ngClass"],["class","alternate-backgrounds","appScrollToTarget","",3,"id",4,"ngFor","ngForOf"],[1,"middle-fill"],["mat-button","",3,"click"],["svgIcon","add_circle_outline"],["appScrollToTarget","",1,"alternate-backgrounds",3,"id"],[3,"link","remaining","linkDeleted"],["class","form-divider",3,"inset",4,"ngIf"],[1,"form-divider",3,"inset"]],template:function(e,t){1&e&&(n.TgZ(0,"div",0),n._UZ(1,"div",1),n.TgZ(2,"div",2),n._uU(3),n.qZA(),n.YNc(4,H,3,4,"div",3),n.TgZ(5,"div",1),n._UZ(6,"span",4),n.TgZ(7,"button",5),n.NdJ("click",function(){return t.addOtherLink()}),n._uU(8," Add linkage "),n._UZ(9,"mat-icon",6),n.qZA(),n.qZA(),n.qZA()),2&e&&(n.xp6(2),n.Q6J("ngClass",0===t.invalidSites?"":"too-many"),n.xp6(1),n.hij("Remaining Links: ",0===t.invalidSites?t.remainingSites.length:t.invalidSites,""),n.xp6(1),n.Q6J("ngForOf",t.links))},directives:[d.mk,d.sg,N.P,z,d.O5,h.d,p.lW,g.Hw],styles:[".form-row[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;padding:5 10px;-ms-flex-align:end;align-items:flex-end;font-size:18px;margin-bottom:5px}.too-many[_ngcontent-%COMP%]{color:var(--regular-red-color)}"]}),o}(),B=i(91434),W=(i(64061),function(){var o=(0,m.Z)(function l(){(0,v.Z)(this,l)});return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[[d.ez,L.o0.forChild(X),y.O,h.t,g.Ps,p.ot,S.w,Z.lN,k.UX,k.u5,T.TU,C.AV,F.vV,x.c,B.LD]]}),o}())}}]);
//# sourceMappingURL=3127.f0d2e72b1ebc6e53.js.map