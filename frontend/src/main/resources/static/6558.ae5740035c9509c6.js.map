{"version":3,"mappings":"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","names":["i0","ctx_r18","ctx_r19","ctx_r25","ctx_r28","ctx_r32","ctx_r36","ctx_r37","ctx_r38","ctx_r39","ctx_r40","ctx_r41","ctx_r42","SubstanceFormDefinitionComponent","cvService","substanceService","substanceFormService","overlayContainerService","configService","l","ENTER","COMMA","FormControl","value","disabled","this","overlayContainer","getContainerElement","menuLabelUpdate","emit","getVocabularies","getTags","subscribe","t","suggestedTags","tags","filteredSuggestedTags","crossCheckTags","tagsCtrl","enable","tagsSubscription","valueChanges","filter","tag","toLowerCase","indexOf","subscriptions","push","configData","showOldLinks","oldlink","subscription","definition","defAccess","getDefinitionForDefRef","substanceClass","toUpperCase","definitionType","definitionLevel","json","getJson","status","getDomainVocabulary","pipe","take","type","vocabularyResponse","RELATIONSHIP_TYPE","dictionary","relationships","length","primarySubstance","find","relationship","getSubstanceSummary","relatedSubstance","refuuid","response","primarySubUuid","uuid","getUuid","imported","getMethod","forEach","unsubscribe","oldSiteRedirect","definitionTypes","DEFINITION_TYPE","list","definitionLevels","DEFINITION_LEVEL","event","indexToRemove","findIndex","n","splice","updateDefinition","substance","setPrimarySubstance","removePrimarySubstance","Object","prototype","toString","call","refPname","_name","approvalID","access","setDefinitionFromDefRef","sort","i","trim","addedTag","addTag","input","tagIndex","usedSuggestedTags","availableTag","option","setValue","tagsInput","nativeElement","decreaseOverlayZindex","autocompleteInputValue","style","zIndex","u","SubstanceFormBase","selectors","ElementRef","SubstanceFormDefinitionModule","C","CommonModule","DynamicComponentLoaderModule","ReactiveFormsModule","FormsModule","MatFormFieldModule","MatSelectModule","MatMenuModule","MatCheckboxModule","MatButtonModule","MatIconModule","SubstanceFormModule","ScrollToModule","SubstanceSelectorModule","MatTooltipModule","RouterModule","MatRadioModule","MatChipsModule","MatAutocompleteModule","MatProgressBarModule"],"sources":["./src/app/core/substance-form/substance-form-definition/substance-form-definition.component.html","./src/app/core/substance-form/substance-form-definition/substance-form-definition.component.ts","./src/app/core/substance-form/substance-form-definition/substance-form-definition.module.ts"],"sourcesContent":["<div *ngIf=\"definition\">\n  <div class=\"substance-form-row form-header\">\n    <div><span class = \"sub-header\">{{(uuid && !imported) ? 'Editing ' : 'Registering New '}}</span>\n      <span> {{substanceClass | titlecase}}</span>\n    </div>\n    <span class = \"approval\" *ngIf = \"definition.approvalID && definition.approvalID !== ''\">{{definition.approvalID}}</span>\n  </div>\n  <div class=\"substance-form-row form-name\" *ngIf = \"definition._name\">\n    <div>Preferred Term: <span class = \"name\" [innerHTML] = \"definition._name\"></span></div>\n  </div>\n  <div class=\"substance-form-row\">\n    <mat-form-field *ngIf = 'definition.substanceClass !== \"concept\"' style = \"margin-right: 5px\">\n      <mat-label>Definition Type</mat-label>\n      <mat-select [(ngModel)]=\"definition.definitionType\" name=\"definitionType\" (selectionChange)=\"updateDefinitionType($event)\" required>\n        <mat-option *ngFor=\"let defitionType of definitionTypes\" [value]=\"defitionType.value\">\n          {{defitionType.display}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <div class=\"primary-substance-container\" *ngIf=\"definition.definitionType == 'ALTERNATIVE'\">\n      <app-substance-selector (selectionUpdated)=\"primartySubstanceUpdated($event)\"\n        eventCategory=\"substanceFormDefinitionType\"\n        placeholder=\"Primary Substance\"\n        header=\"Primary Substance\"\n        [subuuid]=\"primarySubUuid\">\n      </app-substance-selector>\n    </div>\n    <mat-form-field  *ngIf = 'definition.substanceClass !== \"concept\"'>\n      <mat-label>Definition Level</mat-label>\n      <mat-select [(ngModel)]=\"definition.definitionLevel\" name=\"definitionLevel\" (selectionChange)=\"updateDefinition()\">\n        <mat-option *ngFor=\"let defitionLevel of definitionLevels\" [value]=\"defitionLevel.value\">\n          {{defitionLevel.display}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <div class=\"checkbox-container\">\n      <mat-checkbox [(ngModel)]=\"definition.deprecated\" name=\"deprecated\" (change)=\"updateDefinition()\">Deprecated</mat-checkbox>\n    </div>\n    <div>\n      <app-access-manager (accessOut)=\"updateAccess($event)\" [access]=\"definition.access\" label = \"Record Level Access\"></app-access-manager>\n    </div>\n    <div class = 'redirect-links' *ngIf = \"uuid\" >\n      <a [href]=\"getRedirect()\" *ngIf = \"oldlink\" target = \"_blank\" matTooltip= \"open old edit form in new tab\">\n        Old edit form <mat-icon class = \"icon\"  svgIcon=\"open_in_new\"></mat-icon>\n      </a>\n      <br/>\n      <a [routerLink]=\"['/substances', uuid]\" target = \"_blank\" matTooltip= \"open details page in new tab\">\n        Details page <mat-icon class = \"icon\" svgIcon=\"open_in_new\"></mat-icon>\n      </a>\n    </div>\n  </div>\n  <div class=\"substance-form-row\">\n    <mat-form-field class=\"tag-list\">\n      <mat-chip-list #tagList aria-label=\"Tags edit\" selectable=\"false\">\n        <mat-chip\n          *ngFor=\"let tag of definition.tags\"\n          removable=\"true\"\n          (removed)=\"removeTag(tag)\">\n            {{tag}}\n          <mat-icon matChipRemove svgIcon=\"cancel\"></mat-icon>\n        </mat-chip>\n        <input\n          placeholder=\"Substance tags\"\n          #tagsInput\n          [formControl]=\"tagsCtrl\"\n          [matAutocomplete]=\"tagsAuto\"\n          [matChipInputFor]=\"tagList\"\n          [matChipInputSeparatorKeyCodes]=\"separatorKeysCodes\"\n          (matChipInputTokenEnd)=\"tagAdded($event)\"\n          (blur)=\"tagsBlurred()\">\n      </mat-chip-list>\n      <mat-autocomplete\n        #tagsAuto=\"matAutocomplete\"\n        (opened)=\"increaseOverlayZindex()\"\n        (closed)=\"tagsAutocompleteClosed()\"\n        (optionSelected)=\"selectedTag($event)\">\n        <mat-option *ngFor=\"let tag of filteredSuggestedTags\" [value]=\"tag\">\n          {{tag}}\n        </mat-option>\n      </mat-autocomplete>\n      <mat-hint>Enter new tags (and press Enter after each entry) or select from suggested tags below</mat-hint>\n    </mat-form-field>\n  </div>\n  <div class=\"substance-form-row\" *ngIf=\"definition.substanceClass !== 'concept'\">\n    <div class=\"references-container\">\n      <app-domain-references [referencesUuids]=\"definition.references\" card = \"definition\" #references></app-domain-references>\n    </div>\n    <div matTooltip = \"Set {{definition.substanceClass}} access\">\n      <app-access-manager (accessOut)=\"updateDefAccess($event)\" [access]=\"defAccess\" label = \"Definition Access\"></app-access-manager>\n    </div>\n  </div>\n\n  <div class = \"substance-form-row\" *ngIf=\"definition.substanceClass === 'concept'\">\n    Concepts have no defining information, but are collections of terms, codes and related information. <br/> They can be promoted to a defined substance at a later time, when appropriate.\n  </div>\n  <app-audit-info [source] = \"definition\"></app-audit-info>\n</div>\n","import { Component, OnInit, AfterViewInit, OnDestroy, ViewChild, ElementRef } from '@angular/core';\nimport { SubstanceFormBase } from '../base-classes/substance-form-base';\nimport { ControlledVocabularyService } from '../../controlled-vocabulary/controlled-vocabulary.service';\nimport { VocabularyTerm } from '../../controlled-vocabulary/vocabulary.model';\nimport { MatSelectChange } from '@angular/material/select';\nimport { SubstanceService } from '../../substance/substance.service';\nimport { SubstanceSummary, SubstanceRelationship } from '../../substance/substance.model';\nimport { SubstanceFormService } from '../substance-form.service';\nimport { SubstanceFormDefinition } from '../substance-form.model';\nimport {MatChipInputEvent} from '@angular/material/chips';\nimport {MatAutocompleteSelectedEvent} from '@angular/material/autocomplete';\nimport {COMMA, ENTER} from '@angular/cdk/keycodes';\nimport { FormControl } from '@angular/forms';\nimport { OverlayContainer } from '@angular/cdk/overlay';\nimport { Subscription } from 'rxjs';\nimport { take } from 'rxjs/operators';\nimport { ConfigService } from '@gsrs-core/config';\n\n@Component({\n  selector: 'app-substance-form-definition',\n  templateUrl: './substance-form-definition.component.html',\n  styleUrls: ['./substance-form-definition.component.scss']\n})\nexport class SubstanceFormDefinitionComponent extends SubstanceFormBase implements OnInit, AfterViewInit, OnDestroy {\n  definitionTypes: Array<VocabularyTerm>;\n  definitionLevels: Array<VocabularyTerm>;\n  primarySubstance?: SubstanceSummary;\n  definition: SubstanceFormDefinition;\n  primarySubUuid: string;\n  uuid: string;\n  json: any;\n  feature: string;\n  substanceClass: string;\n  status: string;\n  accessLabel?:string;\n  readonly separatorKeysCodes: number[] = [ENTER, COMMA];\n  tagsCtrl = new FormControl({value: '', disabled: true});\n  private suggestedTags: Array<string>;\n  filteredSuggestedTags: Array<string>;\n  private usedSuggestedTags: Array<string> = [];\n  private overlayContainer: HTMLElement;\n  private subscriptions: Array<Subscription> = [];\n  defAccess: Array<any>;\n  @ViewChild('tagsInput', { read: ElementRef, static: false }) tagsInput: ElementRef<HTMLInputElement>;\n  imported = false;\n  oldlink = false;\n\n  constructor(\n    private cvService: ControlledVocabularyService,\n    public substanceService: SubstanceService,\n    private substanceFormService: SubstanceFormService,\n    private overlayContainerService: OverlayContainer,\n    private configService: ConfigService\n  ) {\n    super();\n  }\n\n  ngOnInit() {\n    this.overlayContainer = this.overlayContainerService.getContainerElement();\n    this.menuLabelUpdate.emit('Overview');\n    this.getVocabularies();\n    this.substanceService.getTags().subscribe(tags => {\n      this.suggestedTags = tags;\n      this.filteredSuggestedTags = tags;\n      this.crossCheckTags();\n      this.tagsCtrl.enable();\n    });\n    const tagsSubscription = this.tagsCtrl.valueChanges.subscribe(value => {\n      this.filteredSuggestedTags = this.suggestedTags.filter(tag => tag.toLowerCase().indexOf((value || '').toLowerCase()) > -1);\n    });\n    this.subscriptions.push(tagsSubscription);\n\n    if (this.configService.configData && this.configService.configData.showOldLinks) {\n      this.oldlink = true;\n\n    }\n  }\n\n  ngAfterViewInit() {\n  const subscription =  this.substanceFormService.definition.subscribe(definition => {\n    this.defAccess = this.substanceFormService.getDefinitionForDefRef();\n      this.definition = definition || {};\n      this.crossCheckTags();\n      if (this.definition.substanceClass === 'structure') {\n        this.substanceClass = 'chemical';\n      } else if (this.definition.substanceClass === 'nucleicAcid') {\n        this.substanceClass = 'Nucleic Acid';\n      } else if (this.definition.substanceClass === 'structurallyDiverse') {\n        this.substanceClass = 'Structurally Diverse';\n      } else if (this.definition.substanceClass.toUpperCase() === 'SPECIFIEDSUBSTANCE') {\n        this.substanceClass = 'Specified Substance Group 1';\n      } else if (this.definition.substanceClass.toUpperCase() === 'SPECIFIEDSUBSTANCEG3') {\n        this.substanceClass = 'Specified Substance Group 3';\n      } else {\n        this.substanceClass = this.definition.substanceClass;\n      }\n      if (!this.definition.definitionType) {\n        this.definition.definitionType = 'PRIMARY';\n      }\n\n      if (!this.definition.definitionLevel) {\n        this.definition.definitionLevel = 'COMPLETE';\n      }\n      this.json = this.substanceFormService.getJson();\n      if (this.definition.status) {\n        this.status = this.definition.status;\n      }\n      if (this.definition.definitionType === 'ALTERNATIVE') {\n        this.cvService.getDomainVocabulary('RELATIONSHIP_TYPE').pipe(take(1)).subscribe(vocabularyResponse => {\n          const type = vocabularyResponse['RELATIONSHIP_TYPE']\n            && vocabularyResponse['RELATIONSHIP_TYPE'].dictionary['SUB_ALTERNATE->SUBSTANCE']\n            && vocabularyResponse['RELATIONSHIP_TYPE'].dictionary['SUB_ALTERNATE->SUBSTANCE'].value\n            || null;\n\n          if (type && this.definition.relationships && this.definition.relationships.length) {\n            const primarySubstance = this.definition.relationships.find(relationship => relationship.type === type);\n            if (primarySubstance != null) {\n              this.substanceService.getSubstanceSummary(primarySubstance.relatedSubstance.refuuid).subscribe(response => {\n                this.primarySubstance = response;\n                this.primarySubUuid = this.primarySubstance.uuid;\n              });\n            }\n          }\n        });\n      }\n      this.uuid = this.substanceFormService.getUuid();\n      const imported = this.substanceFormService.getMethod();\n      if (imported && imported === 'import') {\n        this.imported = true;\n      } else {\n        this.imported = false;\n      }\n\n    });\n\n    this.subscriptions.push(subscription);\n\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach(subscription => {\n      subscription.unsubscribe();\n    });\n  }\n\n  getRedirect() {\n    if (this.uuid) {\n      return this.substanceService.oldSiteRedirect('edit', this.substanceFormService.getUuid());\n    } else {\n      return '#';\n    }\n  }\n\n  getVocabularies(): void {\n    this.cvService.getDomainVocabulary('DEFINITION_TYPE', 'DEFINITION_LEVEL').subscribe(response => {\n      this.definitionTypes = response['DEFINITION_TYPE'].list;\n      this.definitionLevels = response['DEFINITION_LEVEL'].list;\n    });\n  }\n\n  updateDefinitionType(event: MatSelectChange): void {\n    if (this.definition.definitionType === 'PRIMARY' && this.definition.relationships != null && this.definition.relationships.length) {\n      const indexToRemove = this.definition.relationships\n        .findIndex((relationship) => relationship.relatedSubstance.refuuid === this.primarySubstance.uuid);\n      if (indexToRemove > -1) {\n        this.definition.relationships.splice(indexToRemove, 1);\n      }\n      this.primarySubstance = null;\n    }\n    this.substanceFormService.updateDefinition(this.definition);\n  }\n\n  primartySubstanceUpdated(substance?: SubstanceSummary): void {\n    if (substance != null) {\n      this.setPrimarySubstance(substance);\n    } else {\n      this.removePrimarySubstance();\n    }\n  }\n\n  setPrimarySubstance(substance: SubstanceSummary): void {\n\n    this.primarySubstance = substance;\n    this.primarySubUuid = substance.uuid;\n\n    if (this.definition.relationships == null\n      || Object.prototype.toString.call(this.definition.relationships) !== '[object Array]') {\n      this.definition.relationships = [];\n    }\n    this.cvService.getDomainVocabulary('RELATIONSHIP_TYPE').subscribe(vocabularyResponse => {\n      const relationship: SubstanceRelationship = {\n        relatedSubstance: {\n          refuuid: this.primarySubstance.uuid,\n          refPname: this.primarySubstance._name,\n          approvalID: this.primarySubstance.approvalID,\n          substanceClass: 'reference'\n        },\n        access: [],\n        type: vocabularyResponse['RELATIONSHIP_TYPE']\n          && vocabularyResponse['RELATIONSHIP_TYPE'].dictionary['SUB_ALTERNATE->SUBSTANCE']\n          && vocabularyResponse['RELATIONSHIP_TYPE'].dictionary['SUB_ALTERNATE->SUBSTANCE'].value\n          || ''\n      };\n      this.definition.relationships.push(relationship);\n      this.substanceFormService.updateDefinition(this.definition);\n    });\n  }\n\n  removePrimarySubstance(): void {\n    const indexToRemove = this.definition.relationships\n      .findIndex((relationship) => relationship.relatedSubstance.refuuid === this.primarySubUuid);\n    this.definition.relationships.splice(indexToRemove, 1);\n    this.primarySubstance = null;\n    this.substanceFormService.updateDefinition(this.definition);\n  }\n\n  updateAccess(access: Array<string>): void {\n    this.definition.access = access;\n    this.substanceFormService.updateDefinition(this.definition);\n  }\n\n  updateDefAccess(access: Array<string>): void {\n    this.substanceFormService.setDefinitionFromDefRef(access);\n    this.substanceFormService.updateDefinition(this.definition);\n  }\n\n  updateDefinition(): void {\n    this.substanceFormService.updateDefinition(this.definition);\n  }\n\n  private crossCheckTags(): void {\n    if (\n      this.definition != null\n      && this.definition.tags != null\n      && this.definition.tags.length > 0\n      && this.suggestedTags != null) {\n        const tags = this.definition.tags.sort();\n        let i = 0;\n        this.definition.tags.forEach(tag => {\n          for (i = i; i < this.suggestedTags.length; i++) {\n            if (tag.toLowerCase() === this.suggestedTags[i].toLowerCase()) {\n              this.suggestedTags.splice(i, 1);\n              break;\n            }\n          }\n        });\n    }\n  }\n\n  tagAdded(event: MatChipInputEvent): void {\n    if ((event.value || '').trim()) {\n      const addedTag = event.value.trim();\n      this.addTag(addedTag);\n    }\n    if (event.input) {\n      event.input.value = '';\n    }\n  }\n\n  private addTag(addedTag: string): void {\n    this.definition.tags.push(addedTag);\n    this.updateDefinition();\n    for (let i = 0; i < this.suggestedTags.length; i++) {\n      if (addedTag.toLowerCase() === this.suggestedTags[i].toLowerCase()) {\n        this.suggestedTags.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  removeTag(tag: string): void {\n    const tagIndex = this.definition.tags.indexOf(tag);\n\n    if (tagIndex > -1) {\n      this.definition.tags.splice(tagIndex, 1);\n      this.updateDefinition();\n\n      if (this.usedSuggestedTags.length > 0) {\n        for (let i = 0; i < this.usedSuggestedTags.length; i++) {\n          if (tag.toLowerCase() === this.usedSuggestedTags[i].toLowerCase()) {\n            const availableTag = this.usedSuggestedTags.splice(i, 1)[0];\n            this.suggestedTags.push(availableTag);\n            this.suggestedTags.sort();\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  selectedTag(event: MatAutocompleteSelectedEvent): void {\n    this.definition.tags.push(event.option.value);\n    this.updateDefinition();\n    this.tagsCtrl.setValue(null);\n    this.tagsInput.nativeElement.value = '';\n    this.usedSuggestedTags.push(event.option.value);\n    const tagIndex = this.suggestedTags.indexOf(event.option.value);\n    if (tagIndex > -1) {\n      this.suggestedTags.splice(tagIndex, 1);\n    }\n  }\n\n  tagsAutocompleteClosed(): void {\n    this.decreaseOverlayZindex();\n    let autocompleteInputValue = this.tagsCtrl.value;\n    if (autocompleteInputValue != null && autocompleteInputValue !== '') {\n      autocompleteInputValue = autocompleteInputValue.trim();\n      this.addTag(autocompleteInputValue);\n      this.tagsCtrl.setValue(null);\n      this.tagsInput.nativeElement.value = '';\n    }\n  }\n\n  tagsBlurred(): void {\n    if (this.filteredSuggestedTags.length === 0) {\n      let autocompleteInputValue = this.tagsCtrl.value;\n      if (autocompleteInputValue != null && autocompleteInputValue !== '') {\n        autocompleteInputValue = autocompleteInputValue.trim();\n        this.addTag(autocompleteInputValue);\n        this.tagsCtrl.setValue(null);\n        this.tagsInput.nativeElement.value = '';\n      }\n    }\n  }\n\n  increaseOverlayZindex(): void {\n    this.overlayContainer.style.zIndex = '1002';\n  }\n\n  decreaseOverlayZindex(): void {\n    this.overlayContainer.style.zIndex = null;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SubstanceFormDefinitionComponent } from './substance-form-definition.component';\nimport { DynamicComponentLoaderModule } from '../../dynamic-component-loader/dynamic-component-loader.module';\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { SubstanceFormModule } from '../substance-form.module';\nimport { ScrollToModule } from '../../scroll-to/scroll-to.module';\nimport { SubstanceSelectorModule } from '../../substance-selector/substance-selector.module';\nimport {MatTooltipModule} from '@angular/material/tooltip';\nimport {RouterModule} from '@angular/router';\nimport {MatRadioModule} from '@angular/material/radio';\nimport {MatChipsModule} from '@angular/material/chips';\nimport {MatProgressBarModule} from '@angular/material/progress-bar';\nimport {MatAutocompleteModule} from '@angular/material/autocomplete';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        DynamicComponentLoaderModule.forChild(SubstanceFormDefinitionComponent),\n        ReactiveFormsModule,\n        FormsModule,\n        MatFormFieldModule,\n        MatSelectModule,\n        MatMenuModule,\n        MatCheckboxModule,\n        MatButtonModule,\n        MatIconModule,\n        SubstanceFormModule,\n        ScrollToModule,\n        SubstanceSelectorModule,\n        MatTooltipModule,\n        RouterModule,\n        MatRadioModule,\n        MatChipsModule,\n        MatAutocompleteModule,\n        MatProgressBarModule\n    ],\n  declarations: [\n    SubstanceFormDefinitionComponent\n  ]\n})\nexport class SubstanceFormDefinitionModule { }\n"],"sourceRoot":"webpack:///","file":"6558.ae5740035c9509c6.js"}