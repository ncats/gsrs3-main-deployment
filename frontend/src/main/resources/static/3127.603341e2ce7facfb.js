"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[3127],{93127:function(q,f,i){i.r(f),i.d(f,{SubstanceFormLinksModule:function(){return W}});var m=i(48047),v=i(78069),d=i(36362),L=i(75143),y=i(7168),h=i(19975),g=i(65590),p=i(87317),S=i(94673),Z=i(44770),k=i(90587),T=i(26439),x=i(43365),C=i(40089),F=i(31959),I=i(24582),A=i(7318),D=i(79550),b=i(33567),O=i(40104),U=i(21109),t=i(76442),M=i(78444),N=i(51279),E=i(18291),J=i(63169),P=i(39401),Y=i(59295),Q=i(95758),R=i(66088),j=i(16667),V=i(14900);function $(o,l){if(1&o){var e=t.EpF();t.TgZ(0,"div",16),t._uU(1," Deleted\xa0 "),t.TgZ(2,"button",17),t.NdJ("click",function(){return t.CHM(e),t.oxw().undoDelete()}),t._UZ(3,"mat-icon",18),t.qZA(),t.qZA()}}function G(o,l){if(1&o&&(t.TgZ(0,"div"),t._UZ(1,"img",19),t.qZA()),2&o){var e=t.oxw();t.xp6(1),t.Q6J("src",e.structure,t.LSH)}}var z=function(){var o=function(){function l(e,n,a,s,u){(0,v.Z)(this,l),this.cvService=e,this.dialog=n,this.utilsService=a,this.overlayContainerService=s,this.substanceFormService=u,this.linkDeleted=new t.vpe,this.subscriptions=[],this.structure=null}return(0,m.Z)(l,[{key:"ngOnInit",value:function(){this.getVocabularies(),this.overlayContainer=this.overlayContainerService.getContainerElement(),this.updateDisplay()}},{key:"getStructure",value:function(){var n=this;this.smiles=this.vocabulary[this.privateLink.linkage],this.smiles&&this.smiles.fragmentStructure?this.structure=this.cvService.getStructureUrlFragment(this.smiles.fragmentStructure):this.cvService.getDomainVocabulary("NUCLEIC_ACID_LINKAGE").pipe((0,Y.q)(1)).subscribe(function(a){var u=!1;a.NUCLEIC_ACID_LINKAGE.list.forEach(function(c){c.value===n.privateLink.linkage&&(n.smiles=c,u=!0,n.structure=n.cvService.getStructureUrlFragment(n.smiles.fragmentStructure))}),u||(n.structure=null)})}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(n){n.unsubscribe()})}},{key:"link",get:function(){return this.updateDisplay(),this.privateLink},set:function(n){this.privateLink=n,this.getStructure()}},{key:"updateLinkage",value:function(n){this.privateLink.linkage=n,this.getStructure()}},{key:"addRemainingSites",value:function(){this.privateLink.sites=this.privateLink.sites?this.privateLink.sites.concat(this.remaining):this.remaining,this.updateDisplay(),this.substanceFormService.emitLinkUpdate()}},{key:"updateDisplay",value:function(){this.privateLink&&(this.siteDisplay=this.substanceFormService.siteString(this.privateLink.sites))}},{key:"deleteLink",value:function(){var n=this;this.privateLink.$$deletedCode=this.utilsService.newUUID(),this.deleteTimer=setTimeout(function(){n.linkDeleted.emit(n.link),n.substanceFormService.emitLinkUpdate()},2e3)}},{key:"undoDelete",value:function(){clearTimeout(this.deleteTimer),delete this.privateLink.$$deletedCode}},{key:"getVocabularies",value:function(){var n=this,a=this.cvService.getDomainVocabulary("NUCLEIC_ACID_LINKAGE").subscribe(function(s){n.linkageTypes=s.NUCLEIC_ACID_LINKAGE.list,n.vocabulary=s.NUCLEIC_ACID_LINKAGE.dictionary,n.smiles=n.vocabulary[n.privateLink.linkage],n.getStructure()});this.subscriptions.push(a)}},{key:"openDialog",value:function(){var n=this,a=this.dialog.open(P.r,{data:{card:"link",link:this.privateLink.sites},width:"1040px"});this.overlayContainer.style.zIndex="1002";var s=a.afterClosed().subscribe(function(u){n.overlayContainer.style.zIndex=null,u&&(n.privateLink.sites=u),n.updateDisplay(),n.substanceFormService.emitLinkUpdate()});this.subscriptions.push(s)}}]),l}();return o.\u0275fac=function(e){return new(e||o)(t.Y36(E.I),t.Y36(Q.uw),t.Y36(J.FW),t.Y36(R.Xj),t.Y36(b.B))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-link-form"]],inputs:{remaining:"remaining",link:"link"},outputs:{linkDeleted:"linkDeleted"},decls:19,vars:8,consts:[[1,"link-form-container"],["class","notification-backdrop",4,"ngIf"],[1,"form-row"],[1,"delete-container"],["mat-icon-button","","matTooltip","Delete link",3,"click"],["svgIcon","delete_forever"],[4,"ngIf"],[1,"type"],["domain","NUCLEIC_ACID_LINKAGE","title","Sequence Type",3,"model","valueChange"],[1,"addRemaining"],["mat-flat-button","","mat-primary","",3,"matTooltip","disabled","click"],[1,"links"],[1,"label"],["mat-icon-button","","matTooltip","Select sites from display",3,"click"],["svgIcon","edit"],[3,"source"],[1,"notification-backdrop"],["mat-icon-button","","matTooltip","Undo",3,"click"],["svgIcon","undo"],[1,"structure-image",3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,$,4,0,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"button",4),t.NdJ("click",function(){return n.deleteLink()}),t._UZ(5,"mat-icon",5),t.qZA(),t.qZA(),t.YNc(6,G,2,1,"div",6),t.TgZ(7,"div",7),t.TgZ(8,"app-cv-input",8),t.NdJ("valueChange",function(s){return n.updateLinkage(s)}),t.qZA(),t.qZA(),t.TgZ(9,"div",9),t.TgZ(10,"button",10),t.NdJ("click",function(){return n.addRemainingSites()}),t._uU(11),t.qZA(),t.qZA(),t.TgZ(12,"div",11),t.TgZ(13,"div",12),t._uU(14,"link"),t.qZA(),t._uU(15),t.TgZ(16,"button",13),t.NdJ("click",function(){return n.openDialog()}),t._UZ(17,"mat-icon",14),t.qZA(),t.qZA(),t.qZA(),t._UZ(18,"app-audit-info",15),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.link.$$deletedCode),t.xp6(5),t.Q6J("ngIf",n.structure),t.xp6(2),t.Q6J("model",n.privateLink.linkage),t.xp6(2),t.MGl("matTooltip","Add remaining ",n.remaining.length," sites"),t.Q6J("disabled",0===n.remaining.length),t.xp6(1),t.hij(" add remaining ",n.remaining.length," sites "),t.xp6(4),t.hij(" ",n.siteDisplay," "),t.xp6(3),t.Q6J("source",n.privateLink))},directives:[d.O5,p.lW,C.gM,g.Hw,j.S,V.n],styles:[".link-form-container[_ngcontent-%COMP%]{padding:30px 10px 12px;position:relative}.notification-backdrop[_ngcontent-%COMP%]{position:absolute;top:0;right:0;bottom:0;left:0;display:-ms-flexbox;display:flex;z-index:10;background-color:#fffc;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;font-size:30px;font-weight:700;color:#666}.form-row[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:end;align-items:flex-end}.form-row[_ngcontent-%COMP%]   .delete-container[_ngcontent-%COMP%]{padding:0 10px 8px 0}.form-row[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{-ms-flex-positive:1;flex-grow:1;padding-right:15px}.form-row[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{width:30%;margin-right:5px}.form-row[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]{width:40%}.form-row[_ngcontent-%COMP%]   .addRemaining[_ngcontent-%COMP%]{width:20%}.selectedSite[_ngcontent-%COMP%]{padding-left:2px;padding-right:2px}.structure-image[_ngcontent-%COMP%]{margin-bottom:-20px;margin-left:-10px}"]}),o}();function K(o,l){1&o&&t._UZ(0,"mat-divider",10),2&o&&t.Q6J("inset",!0)}function H(o,l){if(1&o){var e=t.EpF();t.TgZ(0,"div",7),t.TgZ(1,"app-link-form",8),t.NdJ("linkDeleted",function(r){return t.CHM(e),t.oxw().deleteLink(r)}),t.qZA(),t.YNc(2,K,1,1,"mat-divider",9),t.qZA()}if(2&o){var n=l.$implicit,a=l.last,s=l.index,u=t.oxw();t.Q6J("id","substance-other-links-"+s),t.xp6(1),t.Q6J("link",n)("remaining",u.remainingSites),t.xp6(1),t.Q6J("ngIf",!a)}}var X=function(){var o=function(l){(0,I.Z)(n,l);var e=(0,A.Z)(n);function n(a,s,u,c){var r;return(0,v.Z)(this,n),(r=e.call(this,c)).substanceFormLinksService=a,r.substanceFormService=s,r.scrollToService=u,r.gaService=c,r.remainingSites=[],r.invalidSites=0,r.subscriptions=[],r.analyticsEventCategory="substance form links",r}return(0,m.Z)(n,[{key:"ngOnInit",value:function(){this.canAddItemUpdate.emit(!0),this.menuLabelUpdate.emit("Links")}},{key:"ngAfterViewInit",value:function(){var s=this,u=this.substanceFormLinksService.substanceLinks.subscribe(function(r){s.links=r,s.getRemainingSites()});this.subscriptions.push(u);var c=this.substanceFormService.substanceSubunits.subscribe(function(r){s.subunits=r,s.getRemainingSites()});this.subscriptions.push(c)}},{key:"ngOnDestroy",value:function(){this.componentDestroyed.emit(),this.subscriptions.forEach(function(s){s.unsubscribe()})}},{key:"getRemainingSites",value:function(){var s=[],u=[];this.subunits&&this.links&&(this.subunits.forEach(function(c){if(null!=c.sequence&&c.sequence.length>0)for(var r=2;r<=c.sequence.length;r++)u.push({subunitIndex:c.subunitIndex,residueIndex:r})}),this.links.forEach(function(c){s=s.concat(c.sites)})),this.remainingSites=u.filter(function(c){return!s.some(function(r){return c.subunitIndex===r.subunitIndex&&c.residueIndex===r.residueIndex})}),this.invalidSites=u.length-s.length}},{key:"addItem",value:function(){this.addOtherLink()}},{key:"addOtherLink",value:function(){var s=this;this.substanceFormLinksService.addSubstanceLink(),setTimeout(function(){s.scrollToService.scrollToElement("substance-other-links-0","center")})}},{key:"deleteLink",value:function(s){this.substanceFormLinksService.deleteSubstanceLink(s)}}]),n}(D.u);return o.\u0275fac=function(e){return new(e||o)(t.Y36(U.e),t.Y36(b.B),t.Y36(M.i),t.Y36(O.$))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-substance-form-links"]],features:[t.qOj],decls:10,vars:3,consts:[[1,"responsive"],[1,"form-row"],[1,"form-row",3,"ngClass"],["class","alternate-backgrounds","appScrollToTarget","",3,"id",4,"ngFor","ngForOf"],[1,"middle-fill"],["mat-button","",3,"click"],["svgIcon","add_circle_outline"],["appScrollToTarget","",1,"alternate-backgrounds",3,"id"],[3,"link","remaining","linkDeleted"],["class","form-divider",3,"inset",4,"ngIf"],[1,"form-divider",3,"inset"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"div",1),t.TgZ(2,"div",2),t._uU(3),t.qZA(),t.YNc(4,H,3,4,"div",3),t.TgZ(5,"div",1),t._UZ(6,"span",4),t.TgZ(7,"button",5),t.NdJ("click",function(){return n.addOtherLink()}),t._uU(8," Add linkage "),t._UZ(9,"mat-icon",6),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngClass",0===n.invalidSites?"":"too-many"),t.xp6(1),t.hij("Remaining Links: ",0===n.invalidSites?n.remainingSites.length:n.invalidSites,""),t.xp6(1),t.Q6J("ngForOf",n.links))},directives:[d.mk,d.sg,N.P,z,d.O5,h.d,p.lW,g.Hw],styles:[".form-row[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;padding:5 10px;-ms-flex-align:end;align-items:flex-end;font-size:18px;margin-bottom:5px}.too-many[_ngcontent-%COMP%]{color:red}"]}),o}(),B=i(91434),W=(i(64061),function(){var o=(0,m.Z)(function l(){(0,v.Z)(this,l)});return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[d.ez,L.o0.forChild(X),y.O,h.t,g.Ps,p.ot,S.w,Z.lN,k.UX,k.u5,T.TU,C.AV,F.vV,x.c,B.LD]]}),o}())}}]);
//# sourceMappingURL=3127.603341e2ce7facfb.js.map