"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[7333],{27333:function(nt,h,n){n.r(h),n.d(h,{SubstanceFormStructureModule:function(){return et}});var S=n(48047),b=n(78069),p=n(36362),T=n(24582),M=n(7318),F=n(79223),I=n(33567),_=n(9552),C=n(69093),O=n(45592),U=n(40104),k=n(99146),A=n(12570),E=n(34470),z=n(27336),t=n(76442),N=n(83448),J=n(95758),P=n(66088),L=n(82835),x=n(87317),y=n(65590),g=n(82796),D=n(17537);function Y(s,c){if(1&s){var u=t.EpF();t.TgZ(0,"div",6),t._UZ(1,"span",7),t.TgZ(2,"span",8),t.TgZ(3,"button",9),t.NdJ("click",function(){return t.CHM(u),t.oxw().openStructureImportDialog()}),t._UZ(4,"mat-icon",10),t._uU(5," Import "),t.qZA(),t.TgZ(6,"button",11),t.NdJ("click",function(){return t.CHM(u),t.oxw().openStructureExportDialog()}),t._UZ(7,"mat-icon",12),t._uU(8," Export "),t.qZA(),t.TgZ(9,"button",13),t.NdJ("click",function(){return t.CHM(u),t.oxw().openStructureImageModal()}),t._UZ(10,"mat-icon",14),t._uU(11," View stereochemistry "),t.qZA(),t.qZA(),t.qZA()}}function H(s,c){if(1&s){var u=t.EpF();t.TgZ(0,"div",6),t.TgZ(1,"span",15),t.TgZ(2,"button",16),t.NdJ("click",function(){return t.CHM(u),t.oxw().duplicateCheck()}),t._UZ(3,"mat-icon",17),t._uU(4," Check for duplicates "),t.qZA(),t.qZA(),t._UZ(5,"span",7),t.TgZ(6,"span",8),t.TgZ(7,"button",18),t._UZ(8,"mat-icon",10),t._uU(9," Import \u25bc "),t.qZA(),t.TgZ(10,"button",11),t.NdJ("click",function(){return t.CHM(u),t.oxw().openStructureExportDialog()}),t._UZ(11,"mat-icon",12),t._uU(12," Export "),t.qZA(),t.TgZ(13,"button",13),t.NdJ("click",function(){return t.CHM(u),t.oxw().openStructureImageModal()}),t._UZ(14,"mat-icon",14),t._uU(15," View stereochemistry "),t.qZA(),t.qZA(),t.TgZ(16,"mat-menu",null,19),t.TgZ(18,"button",20),t.NdJ("click",function(){return t.CHM(u),t.oxw().openStructureImportDialog()}),t._uU(19," Import Structure "),t.qZA(),t.TgZ(20,"button",20),t.NdJ("click",function(){return t.CHM(u),t.oxw().openNameResolverDialog()}),t._uU(21," Resolve name "),t.qZA(),t.qZA(),t.qZA()}if(2&s){var i=t.MAs(17);t.xp6(7),t.Q6J("matMenuTriggerFor",i)}}function Q(s,c){if(1&s&&(t.TgZ(0,"span"),t._UZ(1,"br"),t.TgZ(2,"a",29),t._uU(3),t.qZA(),t.qZA()),2&s){var u=c.$implicit,i=t.oxw(3);t.xp6(2),t.Q6J("href",i.fixLink(u.href),t.LSH),t.xp6(1),t.hij(" ",u.text," ")}}function R(s,c){if(1&s){var u=t.EpF();t.TgZ(0,"div",23),t.TgZ(1,"div",24),t._uU(2),t.qZA(),t.TgZ(3,"div",25),t._uU(4),t.YNc(5,Q,4,2,"span",26),t.qZA(),t.TgZ(6,"button",27),t.NdJ("click",function(){var o=t.CHM(u).index;return t.oxw(2).dismissErrorMessage(o)}),t._UZ(7,"mat-icon",28),t.qZA(),t.qZA()}if(2&s){var i=c.$implicit;t.xp6(1),t.Q6J("ngClass",i.messageType),t.xp6(1),t.Oqu(i.messageType),t.xp6(2),t.Oqu(i.message),t.xp6(1),t.Q6J("ngForOf",i.links)}}function w(s,c){if(1&s&&(t.TgZ(0,"div",21),t.YNc(1,R,8,4,"div",22),t.qZA()),2&s){var u=t.oxw();t.xp6(1),t.Q6J("ngForOf",u.structureErrorsArray)}}function j(s,c){if(1&s){var u=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"button",31),t.NdJ("click",function(){return t.CHM(u),t.oxw().generateSRU()}),t._uU(2,"Generate SRUs"),t.qZA(),t.qZA()}}var V=function(c,u){return{"messages-container":!0,collapsed:c,expanded:u}},B=function(){var s=function(c){(0,T.Z)(i,c);var u=(0,M.Z)(i);function i(r,e,o,a,m,v,f,d,rt){var l;return(0,b.Z)(this,i),(l=u.call(this)).substanceFormService=r,l.substanceFormStructureService=e,l.structureService=o,l.loadingService=a,l.dialog=m,l.overlayContainerService=v,l.gaService=f,l.substanceService=d,l.substanceFormStructuralUnitsService=rt,l.isInitializing=!0,l.subscriptions=[],l}return(0,S.Z)(i,[{key:"ngOnInit",value:function(){var e=this;this.overlayContainer=this.overlayContainerService.getContainerElement();var o=this.substanceFormService.definition.subscribe(function(m){if(e.substanceType=m.substanceClass,"polymer"===e.substanceType){e.menuLabelUpdate.emit("Idealized Structure");var v=e.substanceFormStructureService.substanceIdealizedStructure.subscribe(function(d){d&&(e.structure=d),e.loadStructure()});e.subscriptions.push(v)}else{e.menuLabelUpdate.emit("Structure");var f=e.substanceFormStructureService.substanceStructure.subscribe(function(d){e.structure=d,e.loadStructure()});e.subscriptions.push(f)}});this.subscriptions.push(o),this.substanceFormService.resolvedMol.subscribe(function(m){null!=m&&""!==m&&(e.updateStructureForm(m),e.structureEditor.setMolecule(m))})}},{key:"ngAfterViewInit",value:function(){}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(e){e.unsubscribe()})}},{key:"editorOnLoad",value:function(e){var o=this;this.loadingService.setLoading(!1),this.structureEditor=e,this.loadStructure(),this.structureEditor.structureUpdated().subscribe(function(a){o.updateStructureForm(a),o.smiles=o.structure&&o.structure.smiles||null,o.mol=o.structure&&o.structure.molfile||null}),this.isInitializing=!1}},{key:"startInitializing",value:function(){this.isInitializing=!0}},{key:"endInitializing",value:function(){this.isInitializing=!1}},{key:"loadStructure",value:function(){this.structure&&this.structureEditor&&this.structure.molfile&&(this.isInitializing=!0,this.structureEditor.setMolecule(this.structure.molfile),this.smiles=this.structure.smiles,this.mol=this.structure.molfile,this.isInitializing=!1)}},{key:"molvecUpdate",value:function(e){this.updateStructureForm(e),this.structureEditor.setMolecule(e)}},{key:"updateStructureForm",value:function(e){var o=this;this.isInitializing||(this.structure.molfile=e,this.structureService.interpretStructure(e).subscribe(function(a){o.processStructurePostResponse(a)}))}},{key:"processStructurePostResponse",value:function(e){var o=this;e&&e.structure&&("polymer"===this.substanceType||this.structure.hash!==e.structure.hash||this.structure.charge!==e.structure.charge)&&(this.smiles=e.structure.smiles,this.mol=e.structure.molfile,Object.keys(e.structure).forEach(function(a){"molfile"!==a&&(o.structure[a]=e.structure[a])}),this.structure.uuid="",this.substanceFormStructureService.updateMoieties(e.moieties),"polymer"!==this.substanceType&&e.moieties&&e.moieties.length>1&&(clearTimeout(this.userMessageTimer),this.userMessage="Certain moieties may have been updated and/or deleted. Please check that the changes are correct.",this.userMessageTimer=setTimeout(function(){o.userMessage=null},2e4)))}},{key:"openStructureImportDialog",value:function(){var e=this;this.gaService.sendEvent("structureForm","button:import","import structure");var o=this.dialog.open(C.Nt,{height:"auto",width:"650px",data:{}});this.overlayContainer.style.zIndex="1002",o.afterClosed().subscribe(function(a){e.overlayContainer.style.zIndex=null,null!=a&&(a&&a.structure&&a.structure.molfile&&e.structureEditor.setMolecule(a.structure.molfile),e.processStructurePostResponse(a))},function(){})}},{key:"generateSRU",value:function(){var e=this;this.loadingService.setLoading(!0),this.structureService.interpretStructure(this.structure.molfile).subscribe(function(o){o.structuralUnits&&o.structuralUnits.length>0&&e.substanceFormStructuralUnitsService.updateSRUs(o.structuralUnits),e.loadingService.setLoading(!1)},function(o){e.loadingService.setLoading(!1)})}},{key:"openStructureExportDialog",value:function(){var e=this,o=this.dialog.open(O.g,{height:"auto",width:"650px",data:{molfile:this.mol,smiles:this.smiles,type:this.substanceType}});this.overlayContainer.style.zIndex="1002",o.afterClosed().subscribe(function(){e.overlayContainer.style.zIndex=null},function(){e.overlayContainer.style.zIndex=null})}},{key:"openNameResolverDialog",value:function(){var e=this;this.gaService.sendEvent("structureForm","button:resolveName","resolve name");var o=this.dialog.open(k.a,{height:"auto",width:"800px",data:{}});this.overlayContainer.style.zIndex="1002",o.afterClosed().subscribe(function(a){e.overlayContainer.style.zIndex=null,null!=a&&""!==a&&(e.updateStructureForm(a),e.structureEditor.setMolecule(a))},function(){})}},{key:"openStructureImageModal",value:function(){var e=this,o=this.dialog.open(C.oV,{height:"90%",width:"650px",panelClass:"structure-image-panel",data:{structure:this.structure.id}});this.overlayContainer.style.zIndex="1002",o.afterClosed().subscribe(function(){e.overlayContainer.style.zIndex=null},function(){e.overlayContainer.style.zIndex=null})}},{key:"duplicateCheck",value:function(){var e=this;this.structureErrorsArray=[],this.substanceFormService.structureDuplicateCheck().subscribe(function(o){o.forEach(function(a){a.messageType&&"INFO"!==a.messageType&&e.structureErrorsArray.push(a)})})}},{key:"dismissErrorMessage",value:function(e){this.structureErrorsArray.splice(e,1)}},{key:"fixLink",value:function(e){return this.substanceService.oldLinkFix(e)}}]),i}(F.o);return s.\u0275fac=function(u){return new(u||s)(t.Y36(I.B),t.Y36(z.p),t.Y36(_.D),t.Y36(N.b),t.Y36(J.uw),t.Y36(P.Xj),t.Y36(U.$),t.Y36(A.d),t.Y36(E.Z))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-substance-form-structure-card"]],features:[t.qOj],decls:11,vars:11,consts:[[2,"z-index","9999",3,"loadedMolfile","editorOnLoad"],[3,"ngClass"],["class","button-row",4,"ngIf"],["class","submission-messages",4,"ngIf"],["showSettings","true",3,"structure","type"],["class","button-container",4,"ngIf"],[1,"button-row"],[1,"middle-fill"],[1,"right-buttons"],["mat-button","","color","primary","matTooltip","Import options",3,"click"],["svgIcon","cloud_upload"],["mat-button","","color","primary","matTooltip","export structure",3,"click"],["svgIcon","get_app"],["mat-button","","color","primary","matTooltip","preview structure stereochemistry",3,"click"],["svgIcon","zoom_in"],[1,"left-buttons"],["matTooltip","check the database for duplicate structures","mat-button","","color","primary",1,"dupe-check",3,"click"],["svgIcon","search"],["mat-button","","color","primary","matTooltip","Import options",3,"matMenuTriggerFor"],["importMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"submission-messages"],["class","validation-message",4,"ngFor","ngForOf"],[1,"validation-message"],[1,"message-type",3,"ngClass"],[1,"message"],[4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","Dismiss",3,"click"],["svgIcon","close"],["target","_blank",1,"internal-link",3,"href"],[1,"button-container"],["color","primary","matTooltip","generate structural units for this structure",1,"mat-flat-button","mat-primary",3,"click"]],template:function(u,i){1&u&&(t.TgZ(0,"div"),t.TgZ(1,"div"),t.TgZ(2,"div"),t.TgZ(3,"app-structure-editor",0),t.NdJ("loadedMolfile",function(e){return i.molvecUpdate(e)})("editorOnLoad",function(e){return i.editorOnLoad(e)}),t.qZA(),t.qZA(),t.TgZ(4,"div",1),t._uU(5),t.qZA(),t.qZA(),t.YNc(6,Y,12,0,"div",2),t.YNc(7,H,22,1,"div",2),t.YNc(8,w,2,1,"div",3),t._UZ(9,"app-structure-form",4),t.YNc(10,j,3,0,"div",5),t.qZA()),2&u&&(t.xp6(4),t.Q6J("ngClass",t.WLB(8,V,!i.userMessage,i.userMessage)),t.xp6(1),t.hij(" ",i.userMessage," "),t.xp6(1),t.Q6J("ngIf",i.structure&&"polymer"===i.substanceType),t.xp6(1),t.Q6J("ngIf",i.structure&&"structure"===i.substanceType),t.xp6(1),t.Q6J("ngIf",i.structureErrorsArray&&i.structureErrorsArray.length>0),t.xp6(1),t.Q6J("structure",i.structure)("type",i.substanceType),t.xp6(1),t.Q6J("ngIf","polymer"===i.substanceType))},directives:[L.K,p.mk,p.O5,x.lW,y.Hw,g.p6,g.VK,g.OP,p.sg,D.h],styles:[".messages-container[_ngcontent-%COMP%]{text-align:center;font-weight:500;font-size:1.05em;transition:all .5s ease-out;overflow:hidden}.messages-container.collapsed[_ngcontent-%COMP%]{max-height:0}.messages-container.expanded[_ngcontent-%COMP%]{max-height:500px;padding:10px 0 5px}.button-container[_ngcontent-%COMP%]{margin-top:-50px}.button-row[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;width:100%;margin-bottom:10px}.button-row[_ngcontent-%COMP%]   .right-buttons[_ngcontent-%COMP%]{-ms-flex-line-pack:end;align-content:flex-end;display:-ms-flexbox;display:flex;margin-right:-8px}.button-row[_ngcontent-%COMP%]   .left-buttons[_ngcontent-%COMP%]{-ms-flex-line-pack:start;align-content:flex-start;display:-ms-flexbox;display:flex}.SUCCESS[_ngcontent-%COMP%]{color:#3f914c;background-color:#def2de}.submission-messages[_ngcontent-%COMP%]{overflow:hidden;height:auto;transition:all .5s ease-out;max-width:1028px;width:100%;background-color:#fff;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;max-height:500px;overflow-y:auto;padding:10px}.submission-messages[_ngcontent-%COMP%]   .validation-message[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;padding:5px 0;-ms-flex-align:center;align-items:center}.submission-messages[_ngcontent-%COMP%]   .validation-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{text-transform:uppercase;font-weight:500;margin-right:20px;padding:10px;border-radius:3px}.submission-messages[_ngcontent-%COMP%]   .dismiss-container[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex}.WARNING[_ngcontent-%COMP%]{color:#8a6d3b;background-color:#fcf8e3}.ERROR[_ngcontent-%COMP%]{color:#a94442;background-color:#f2dede}.dupe-check[_ngcontent-%COMP%]{margin-bottom:5px}.internal-link[_ngcontent-%COMP%]{color:#448aff}.z-index[_ngcontent-%COMP%]{z-index:9999!important}"]}),s}(),W=n(64061),X=n(56473),$=n(44770),G=n(43365),Z=n(90587),K=n(91434),q=n(7168),tt=n(96769),et=function(){var s=(0,S.Z)(function c(){(0,b.Z)(this,c)});return s.\u0275fac=function(u){return new(u||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[p.ez,W.o.forChild(B),X.h,$.lN,G.c,Z.UX,Z.u5,K.LD,q.O,tt.O,g.Tx,y.Ps,x.ot]]}),s}()}}]);
//# sourceMappingURL=7333.2688bf4de8850664.js.map