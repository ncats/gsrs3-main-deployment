"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[6558],{16558:function(ve,b,s){s.r(b),s.d(b,{SubstanceFormDefinitionModule:function(){return ge}});var S=s(48047),_=s(78069),p=s(36362),E=s(24582),O=s(7318),e=s(76442),M=s(79223),N=s(42827),P=s(12570),U=s(33567),y=s(75939),f=s(90587),L=s(59295),J=s(53141),H=s(66088),h=s(98002),g=s(44770),x=s(91434),Q=s(1130),Y=s(24459),Z=s(61534),w=s(84577),A=s(40089),D=s(65590),m=s(81196),T=s(43188),R=s(48302),k=s(14900),B=["tagsInput"];function V(i,c){if(1&i&&(e.TgZ(0,"span",23),e._uU(1),e.qZA()),2&i){var o=e.oxw(2);e.xp6(1),e.Oqu(o.definition.approvalID)}}function j(i,c){if(1&i&&(e.TgZ(0,"div",24),e.TgZ(1,"div"),e._uU(2,"Display Name: "),e._UZ(3,"span",25),e.qZA(),e.qZA()),2&i){var o=e.oxw(2);e.xp6(3),e.Q6J("innerHTML",o.definition._nameHTML?o.definition._nameHTML:o.definition._name,e.oJD)}}function q(i,c){if(1&i&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),2&i){var o=c.$implicit;e.Q6J("value",o.value),e.xp6(1),e.hij(" ",o.display," ")}}function z(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"mat-form-field",26),e.TgZ(1,"mat-label"),e._uU(2,"Definition Type"),e.qZA(),e.TgZ(3,"mat-select",27),e.NdJ("ngModelChange",function(t){return e.CHM(o),e.oxw(2).definition.definitionType=t})("selectionChange",function(t){return e.CHM(o),e.oxw(2).updateDefinitionType(t)}),e.YNc(4,q,2,2,"mat-option",20),e.qZA(),e.qZA()}if(2&i){var u=e.oxw(2);e.xp6(3),e.Q6J("ngModel",u.definition.definitionType),e.xp6(1),e.Q6J("ngForOf",u.definitionTypes)}}function G(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"div",29),e.TgZ(1,"app-substance-selector",30),e.NdJ("selectionUpdated",function(t){return e.CHM(o),e.oxw(2).primartySubstanceUpdated(t)}),e.qZA(),e.qZA()}if(2&i){var u=e.oxw(2);e.xp6(1),e.Q6J("subuuid",u.primarySubUuid)}}function K(i,c){if(1&i&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),2&i){var o=c.$implicit;e.Q6J("value",o.value),e.xp6(1),e.hij(" ",o.display," ")}}function X(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"mat-form-field"),e.TgZ(1,"mat-label"),e._uU(2,"Definition Level"),e.qZA(),e.TgZ(3,"mat-select",31),e.NdJ("ngModelChange",function(t){return e.CHM(o),e.oxw(2).definition.definitionLevel=t})("selectionChange",function(){return e.CHM(o),e.oxw(2).updateDefinition()}),e.YNc(4,K,2,2,"mat-option",20),e.qZA(),e.qZA()}if(2&i){var u=e.oxw(2);e.xp6(3),e.Q6J("ngModel",u.definition.definitionLevel),e.xp6(1),e.Q6J("ngForOf",u.definitionLevels)}}function $(i,c){if(1&i&&(e.TgZ(0,"a",36),e._uU(1," Old edit form "),e._UZ(2,"mat-icon",35),e.qZA()),2&i){var o=e.oxw(3);e.Q6J("href",o.getRedirect(),e.LSH)}}var W=function(c){return["/substances",c]};function ee(i,c){if(1&i&&(e.TgZ(0,"div",32),e.YNc(1,$,3,1,"a",33),e._UZ(2,"br"),e.TgZ(3,"a",34),e._uU(4," Details page "),e._UZ(5,"mat-icon",35),e.qZA(),e.qZA()),2&i){var o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",o.oldlink),e.xp6(2),e.Q6J("routerLink",e.VKq(2,W,o.uuid))}}function te(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"mat-chip",37),e.NdJ("removed",function(){var n=e.CHM(o).$implicit;return e.oxw(2).removeTag(n)}),e._uU(1),e._UZ(2,"mat-icon",38),e.qZA()}if(2&i){var u=c.$implicit;e.xp6(1),e.hij(" ",u," ")}}function ie(i,c){if(1&i&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),2&i){var o=c.$implicit;e.Q6J("value",o),e.xp6(1),e.hij(" ",o," ")}}function ne(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"div",5),e.TgZ(1,"div",39),e._UZ(2,"app-domain-references",40,41),e.qZA(),e.TgZ(4,"div",42),e.TgZ(5,"app-access-manager",43),e.NdJ("accessOut",function(t){return e.CHM(o),e.oxw(2).updateDefAccess(t)}),e.qZA(),e.qZA(),e.qZA()}if(2&i){var u=e.oxw(2);e.xp6(2),e.Q6J("referencesUuids",u.definition.references),e.xp6(2),e.MGl("matTooltip","Set ",u.definition.substanceClass," access"),e.xp6(1),e.Q6J("access",u.defAccess)}}function oe(i,c){1&i&&(e.TgZ(0,"div",5),e._uU(1," Concepts have no defining information, but are collections of terms, codes and related information. "),e._UZ(2,"br"),e._uU(3," They can be promoted to a defined substance at a later time, when appropriate. "),e.qZA())}function ae(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",1),e.TgZ(2,"div"),e.TgZ(3,"span",2),e._uU(4),e.qZA(),e.TgZ(5,"span"),e._uU(6),e.ALo(7,"titlecase"),e.qZA(),e.qZA(),e.YNc(8,V,2,1,"span",3),e.qZA(),e.YNc(9,j,4,1,"div",4),e.TgZ(10,"div",5),e.YNc(11,z,5,2,"mat-form-field",6),e.YNc(12,G,2,1,"div",7),e.YNc(13,X,5,2,"mat-form-field",0),e.TgZ(14,"div",8),e.TgZ(15,"mat-checkbox",9),e.NdJ("ngModelChange",function(a){return e.CHM(o),e.oxw().definition.deprecated=a})("change",function(){return e.CHM(o),e.oxw().updateDefinition()}),e._uU(16,"Deprecated"),e.qZA(),e.qZA(),e.TgZ(17,"div"),e.TgZ(18,"app-access-manager",10),e.NdJ("accessOut",function(a){return e.CHM(o),e.oxw().updateAccess(a)}),e.qZA(),e.qZA(),e.YNc(19,ee,6,4,"div",11),e.qZA(),e.TgZ(20,"div",5),e.TgZ(21,"mat-form-field",12),e.TgZ(22,"mat-chip-list",13,14),e.YNc(24,te,3,1,"mat-chip",15),e.TgZ(25,"input",16,17),e.NdJ("matChipInputTokenEnd",function(a){return e.CHM(o),e.oxw().tagAdded(a)})("blur",function(){return e.CHM(o),e.oxw().tagsBlurred()}),e.qZA(),e.qZA(),e.TgZ(27,"mat-autocomplete",18,19),e.NdJ("opened",function(){return e.CHM(o),e.oxw().increaseOverlayZindex()})("closed",function(){return e.CHM(o),e.oxw().tagsAutocompleteClosed()})("optionSelected",function(a){return e.CHM(o),e.oxw().selectedTag(a)}),e.YNc(29,ie,2,2,"mat-option",20),e.qZA(),e.TgZ(30,"mat-hint"),e._uU(31,"Enter new tags (and press Enter after each entry) or select from suggested tags below"),e.qZA(),e.qZA(),e.qZA(),e.YNc(32,ne,6,3,"div",21),e.YNc(33,oe,4,0,"div",21),e._UZ(34,"app-audit-info",22),e.qZA()}if(2&i){var u=e.MAs(23),r=e.MAs(28),t=e.oxw();e.xp6(4),e.Oqu(t.uuid&&!t.imported?"Editing ":"Registering New "),e.xp6(2),e.hij(" ",e.lcZ(7,19,t.substanceClass),""),e.xp6(2),e.Q6J("ngIf",t.definition.approvalID&&""!==t.definition.approvalID),e.xp6(1),e.Q6J("ngIf",t.definition._name),e.xp6(2),e.Q6J("ngIf","concept"!==t.definition.substanceClass),e.xp6(1),e.Q6J("ngIf","ALTERNATIVE"==t.definition.definitionType),e.xp6(1),e.Q6J("ngIf","concept"!==t.definition.substanceClass),e.xp6(2),e.Q6J("ngModel",t.definition.deprecated),e.xp6(3),e.Q6J("access",t.definition.access),e.xp6(1),e.Q6J("ngIf",t.uuid),e.xp6(5),e.Q6J("ngForOf",t.definition.tags),e.xp6(1),e.Q6J("formControl",t.tagsCtrl)("matAutocomplete",r)("matChipInputFor",u)("matChipInputSeparatorKeyCodes",t.separatorKeysCodes),e.xp6(4),e.Q6J("ngForOf",t.filteredSuggestedTags),e.xp6(3),e.Q6J("ngIf","concept"!==t.definition.substanceClass),e.xp6(1),e.Q6J("ngIf","concept"===t.definition.substanceClass),e.xp6(1),e.Q6J("source",t.definition)}}var se=function(){var i=function(c){(0,E.Z)(u,c);var o=(0,O.Z)(u);function u(r,t,n,a,d,v){var l;return(0,_.Z)(this,u),(l=o.call(this)).cvService=r,l.substanceService=t,l.substanceFormService=n,l.overlayContainerService=a,l.configService=d,l.activatedRoute=v,l.separatorKeysCodes=[y.K5,y.OC],l.tagsCtrl=new f.NI({value:"",disabled:!0}),l.usedSuggestedTags=[],l.subscriptions=[],l.imported=!1,l.oldlink=!1,l}return(0,S.Z)(u,[{key:"ngOnInit",value:function(){var t=this;this.overlayContainer=this.overlayContainerService.getContainerElement(),this.menuLabelUpdate.emit("Overview"),this.getVocabularies(),this.substanceService.getTags().subscribe(function(a){t.suggestedTags=a,t.filteredSuggestedTags=a,t.crossCheckTags(),t.tagsCtrl.enable()});var n=this.tagsCtrl.valueChanges.subscribe(function(a){t.filteredSuggestedTags=t.suggestedTags.filter(function(d){return d.toLowerCase().indexOf((a||"").toLowerCase())>-1})});this.subscriptions.push(n),this.configService.configData&&this.configService.configData.showOldLinks&&(this.oldlink=!0)}},{key:"ngAfterViewInit",value:function(){var t=this,n=this.substanceFormService.definition.subscribe(function(a){t.defAccess=t.substanceFormService.getDefinitionForDefRef(),t.definition=a||{},t.crossCheckTags(),t.substanceClass="structure"===t.definition.substanceClass?"chemical":"nucleicAcid"===t.definition.substanceClass?"Nucleic Acid":"structurallyDiverse"===t.definition.substanceClass?"Structurally Diverse":"SPECIFIEDSUBSTANCE"===t.definition.substanceClass.toUpperCase()?"Specified Substance Group 1":"SPECIFIEDSUBSTANCEG3"===t.definition.substanceClass.toUpperCase()?"Specified Substance Group 3":t.definition.substanceClass,t.definition.definitionType||(t.definition.definitionType="PRIMARY"),t.definition.definitionLevel||(t.definition.definitionLevel="COMPLETE"),t.json=t.substanceFormService.getJson(),t.definition.status&&(t.status=t.definition.status),"ALTERNATIVE"===t.definition.definitionType&&t.cvService.getDomainVocabulary("RELATIONSHIP_TYPE").pipe((0,L.q)(1)).subscribe(function(l){var F=l.RELATIONSHIP_TYPE&&l.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"]&&l.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"].value||null;if(F&&t.definition.relationships&&t.definition.relationships.length){var I=t.definition.relationships.find(function(C){return C.type===F});null!=I&&t.substanceService.getSubstanceSummary(I.relatedSubstance.refuuid).subscribe(function(C){t.primarySubstance=C,t.primarySubUuid=t.primarySubstance.uuid})}}),t.uuid=t.substanceFormService.getUuid();var d=t.substanceFormService.getMethod(),v=t.activatedRoute.snapshot.queryParams.source||null;t.imported=!(!d||"import"!==d||v&&"draft"===v)});this.subscriptions.push(n)}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(t){t.unsubscribe()})}},{key:"getRedirect",value:function(){return this.uuid?this.substanceService.oldSiteRedirect("edit",this.substanceFormService.getUuid()):"#"}},{key:"getVocabularies",value:function(){var t=this;this.cvService.getDomainVocabulary("DEFINITION_TYPE","DEFINITION_LEVEL").subscribe(function(n){t.definitionTypes=n.DEFINITION_TYPE.list,t.definitionLevels=n.DEFINITION_LEVEL.list})}},{key:"updateDefinitionType",value:function(t){var n=this;if("PRIMARY"===this.definition.definitionType&&null!=this.definition.relationships&&this.definition.relationships.length){var a=this.definition.relationships.findIndex(function(d){return d.relatedSubstance.refuuid===n.primarySubstance.uuid});a>-1&&this.definition.relationships.splice(a,1),this.primarySubstance=null}this.substanceFormService.updateDefinition(this.definition)}},{key:"primartySubstanceUpdated",value:function(t){null!=t?this.setPrimarySubstance(t):this.removePrimarySubstance()}},{key:"setPrimarySubstance",value:function(t){var n=this;this.primarySubstance=t,this.primarySubUuid=t.uuid,(null==this.definition.relationships||"[object Array]"!==Object.prototype.toString.call(this.definition.relationships))&&(this.definition.relationships=[]),this.cvService.getDomainVocabulary("RELATIONSHIP_TYPE").subscribe(function(a){n.definition.relationships.push({relatedSubstance:{refuuid:n.primarySubstance.uuid,refPname:n.primarySubstance._name,approvalID:n.primarySubstance.approvalID,substanceClass:"reference"},access:[],type:a.RELATIONSHIP_TYPE&&a.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"]&&a.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"].value||""}),n.substanceFormService.updateDefinition(n.definition)})}},{key:"removePrimarySubstance",value:function(){var t=this,n=this.definition.relationships.findIndex(function(a){return a.relatedSubstance.refuuid===t.primarySubUuid});this.definition.relationships.splice(n,1),this.primarySubstance=null,this.substanceFormService.updateDefinition(this.definition)}},{key:"updateAccess",value:function(t){this.definition.access=t,this.substanceFormService.updateDefinition(this.definition)}},{key:"updateDefAccess",value:function(t){this.substanceFormService.setDefinitionFromDefRef(t),this.substanceFormService.updateDefinition(this.definition)}},{key:"updateDefinition",value:function(){this.substanceFormService.updateDefinition(this.definition)}},{key:"crossCheckTags",value:function(){var t=this;if(null!=this.definition&&null!=this.definition.tags&&this.definition.tags.length>0&&null!=this.suggestedTags){this.definition.tags.sort();var a=0;this.definition.tags.forEach(function(d){for(a=a;a<t.suggestedTags.length;a++)if(d.toLowerCase()===t.suggestedTags[a].toLowerCase()){t.suggestedTags.splice(a,1);break}})}}},{key:"tagAdded",value:function(t){if((t.value||"").trim()){var n=t.value.trim();this.addTag(n)}t.input&&(t.input.value="")}},{key:"addTag",value:function(t){this.definition.tags.push(t),this.updateDefinition();for(var n=0;n<this.suggestedTags.length;n++)if(t.toLowerCase()===this.suggestedTags[n].toLowerCase()){this.suggestedTags.splice(n,1);break}}},{key:"removeTag",value:function(t){var n=this.definition.tags.indexOf(t);if(n>-1&&(this.definition.tags.splice(n,1),this.updateDefinition(),this.usedSuggestedTags.length>0))for(var a=0;a<this.usedSuggestedTags.length;a++)if(t.toLowerCase()===this.usedSuggestedTags[a].toLowerCase()){var d=this.usedSuggestedTags.splice(a,1)[0];this.suggestedTags.push(d),this.suggestedTags.sort();break}}},{key:"selectedTag",value:function(t){this.definition.tags.push(t.option.value),this.updateDefinition(),this.tagsCtrl.setValue(null),this.tagsInput.nativeElement.value="",this.usedSuggestedTags.push(t.option.value);var n=this.suggestedTags.indexOf(t.option.value);n>-1&&this.suggestedTags.splice(n,1)}},{key:"tagsAutocompleteClosed",value:function(){this.decreaseOverlayZindex();var t=this.tagsCtrl.value;null!=t&&""!==t&&(t=t.trim(),this.addTag(t),this.tagsCtrl.setValue(null),this.tagsInput.nativeElement.value="")}},{key:"tagsBlurred",value:function(){if(0===this.filteredSuggestedTags.length){var t=this.tagsCtrl.value;null!=t&&""!==t&&(t=t.trim(),this.addTag(t),this.tagsCtrl.setValue(null),this.tagsInput.nativeElement.value="")}}},{key:"increaseOverlayZindex",value:function(){this.overlayContainer.style.zIndex="1002"}},{key:"decreaseOverlayZindex",value:function(){this.overlayContainer.style.zIndex=null}}]),u}(M.o);return i.\u0275fac=function(o){return new(o||i)(e.Y36(N.I),e.Y36(P.d),e.Y36(U.B),e.Y36(H.Xj),e.Y36(J.E),e.Y36(h.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-substance-form-definition"]],viewQuery:function(o,u){var r;1&o&&e.Gf(B,5,e.SBq),2&o&&e.iGM(r=e.CRH())&&(u.tagsInput=r.first)},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"substance-form-row","form-header"],[1,"sub-header"],["class","approval",4,"ngIf"],["class","substance-form-row form-name",4,"ngIf"],[1,"substance-form-row"],["style","margin-right: 5px",4,"ngIf"],["class","primary-substance-container",4,"ngIf"],[1,"checkbox-container"],["name","deprecated",3,"ngModel","ngModelChange","change"],["label","Record Level Access",3,"access","accessOut"],["class","redirect-links",4,"ngIf"],[1,"tag-list"],["aria-label","Tags edit","selectable","false"],["tagList",""],["removable","true",3,"removed",4,"ngFor","ngForOf"],["placeholder","Substance tags",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputTokenEnd","blur"],["tagsInput",""],[3,"opened","closed","optionSelected"],["tagsAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["class","substance-form-row",4,"ngIf"],[3,"source"],[1,"approval"],[1,"substance-form-row","form-name"],[1,"name",3,"innerHTML"],[2,"margin-right","5px"],["name","definitionType","required","",3,"ngModel","ngModelChange","selectionChange"],[3,"value"],[1,"primary-substance-container"],["eventCategory","substanceFormDefinitionType","placeholder","Primary Substance","header","Primary Substance",3,"subuuid","selectionUpdated"],["name","definitionLevel",3,"ngModel","ngModelChange","selectionChange"],[1,"redirect-links"],["target","_blank","matTooltip","open old edit form in new tab",3,"href",4,"ngIf"],["target","_blank","matTooltip","open details page in new tab",3,"routerLink"],["svgIcon","open_in_new",1,"icon"],["target","_blank","matTooltip","open old edit form in new tab",3,"href"],["removable","true",3,"removed"],["matChipRemove","","svgIcon","cancel"],[1,"references-container"],["card","definition",3,"referencesUuids"],["references",""],[3,"matTooltip"],["label","Definition Access",3,"access","accessOut"]],template:function(o,u){1&o&&e.YNc(0,ae,35,21,"div",0),2&o&&e.Q6J("ngIf",u.definition)},directives:[p.O5,g.KE,g.hX,x.gD,f.Q7,f.JJ,f.On,p.sg,Q.ey,Y.Q,Z.oG,w.h,A.gM,D.Hw,h.yS,m.qn,m.HS,m.qH,f.Fj,T.ZL,m.oH,f.oH,T.XC,g.bx,R.V,k.n],pipes:[p.rS],styles:[".substance-form-row[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}.approval[_ngcontent-%COMP%]{color:#c7254e;font-size:24px}.primary-substance-container[_ngcontent-%COMP%]{max-width:25%}.section-header[_ngcontent-%COMP%]{color:#0000008a;font-size:11px;text-align:left;letter-spacing:.005px}.form-header[_ngcontent-%COMP%]{padding-bottom:20px;font-weight:500;font-size:28px}.sub-header[_ngcontent-%COMP%]{font-weight:400;padding-right:5px}.references-container[_ngcontent-%COMP%]{width:100%}.checkbox-container[_ngcontent-%COMP%]{padding-top:10px}.definition-reference[_ngcontent-%COMP%]{margin-bottom:0}.redirect-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4793d1!important;float:right;text-decoration:none}.redirect-links[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{-ms-transform:scale(.75);transform:scale(.75)}.icon[_ngcontent-%COMP%]{font-size:10px!important}.set-status[_ngcontent-%COMP%]     .mat-radio-label{-ms-flex-direction:column-reverse;flex-direction:column-reverse}.set-status[_ngcontent-%COMP%]     .mat-radio-label-content{padding-left:5px;font-size:11px;padding-bottom:4px;color:#0000008a;font-weight:400;font-family:Roboto,Helvetica Neue,sans-serif}.status-label[_ngcontent-%COMP%]{padding-right:10px}.message-field[_ngcontent-%COMP%]{width:50%}.form-name[_ngcontent-%COMP%]{font-size:22px;padding-bottom:15px}.name[_ngcontent-%COMP%]{color:#00f;padding-left:5px}.tag-list[_ngcontent-%COMP%]{width:100%}"]}),i}(),re=s(64061),ce=s(82796),ue=s(87317),de=s(7168),le=s(94673),fe=s(63200),me=s(68390),pe=s(60833),ge=function(){var i=(0,S.Z)(function c(){(0,_.Z)(this,c)});return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[p.ez,re.o.forChild(se),f.UX,f.u5,g.lN,x.LD,ce.Tx,Z.p9,ue.ot,D.Ps,de.O,le.w,fe.U,A.AV,h.Bz,me.Fk,m.Hi,T.Bb,pe.Cv]]}),i}()}}]);
//# sourceMappingURL=6558.31834a7e8b6d3cc2.js.map